{% extends 'base.html' %}
{% block content %}
<div class="container-fluid" style="max-width: 1400px; margin: 3.5rem auto 0; padding: 0 1rem;">
  
  <!-- Hero Section -->
  <section class="hero-section" style="background: linear-gradient(135deg, #8B4513 0%, #654321 100%); color: white; padding: 4rem 2rem; text-align: center; border-radius: 20px; margin-bottom: 3rem; position: relative; overflow: hidden;">
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.2); border-radius: 20px;"></div>
    <div style="position: relative; z-index: 2;">
      <h1 style="font-size: 3rem; font-weight: 700; margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
        <i class="fas fa-camera-retro" style="margin-right: 0.75rem; color: #FFD700;"></i>
        Professional Photographers
      </h1>
      <p style="font-size: 1.3rem; opacity: 0.95; margin-bottom: 2.5rem; font-weight: 300;">
        Discover talented photographers across Rwanda and connect with creative professionals
      </p>
      
      <!-- Stats Display -->
      <div style="display: flex; justify-content: center; gap: 3rem; margin-bottom: 2.5rem; flex-wrap: wrap;">
        <div style="text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #FFD700; margin-bottom: 0.5rem;">{{ photographers.count }}</div>
          <div style="font-size: 1rem; opacity: 0.9;">Photographers</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #FFD700; margin-bottom: 0.5rem;">{{ all_locations.count }}</div>
          <div style="font-size: 1rem; opacity: 0.9;">Locations</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #FFD700; margin-bottom: 0.5rem;">100+</div>
          <div style="font-size: 1rem; opacity: 0.9;">Projects Completed</div>
        </div>
      </div>
      
      <!-- Call to Action Buttons -->
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
        <a href="/bookings/create/" 
           class="btn-book-photographer"
           style="background: #FFD700; color: #1a1a1a; padding: 1rem 2.5rem; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; box-shadow: 0 6px 20px rgba(255,215,0,0.4); transition: all 0.3s ease; display: inline-flex; align-items: center; border: none;">
          <i class="fas fa-calendar-check" style="margin-right: 0.75rem;"></i>
          Book a Photographer
        </a>
        {% if user.is_authenticated and user.role == 'photographer' %}
          <a href="{% url 'portfolio:upload_photo' %}" 
             style="background: rgba(255,255,255,0.2); color: white; padding: 1rem 2.5rem; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; border: 2px solid rgba(255,255,255,0.3); transition: all 0.3s ease; display: inline-flex; align-items: center;">
            <i class="fas fa-camera" style="margin-right: 0.75rem;"></i>
            Upload Photo
          </a>
        {% else %}
          <a href="{% url 'users:register' %}" 
             style="background: rgba(255,255,255,0.2); color: white; padding: 1rem 2.5rem; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; border: 2px solid rgba(255,255,255,0.3); transition: all 0.3s ease; display: inline-flex; align-items: center;">
            <i class="fas fa-user-plus" style="margin-right: 0.75rem;"></i>
            Join as Photographer
          </a>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- Enhanced Search and Filters -->
  <section style="background: #fff; border-radius: 16px; padding: 2rem; margin-bottom: 3rem; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
    <h2 style="text-align: center; color: #2c3e50; font-size: 1.8rem; font-weight: 600; margin-bottom: 1.5rem;">
      <i class="fas fa-search" style="margin-right: 0.5rem; color: #8B4513;"></i>
      Find Your Perfect Photographer
    </h2>
    
    <form method="get" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1.5rem; align-items: end;">
      <!-- Search Input -->
      <div>
        <label for="search" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #2c3e50;">Search Photographers</label>
        <input type="text" name="search" id="search" value="{{ search_query }}" placeholder="Search by name or specialization..." 
               style="width: 100%; padding: 0.75rem; border: 2px solid #e9ecef; border-radius: 12px; background: #fff; transition: all 0.3s ease;">
      </div>
      
      <!-- Location Filter -->
      <div>
        <label for="location" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #2c3e50;">Location</label>
        <select name="location" id="location" 
                style="width: 100%; padding: 0.75rem; border: 2px solid #e9ecef; border-radius: 12px; background: #fff; transition: all 0.3s ease;">
          <option value="">All Locations</option>
          {% for location in all_locations %}
            <option value="{{ location }}" {% if location == selected_location %}selected{% endif %}>{{ location }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Action Buttons -->
      <div style="display: flex; gap: 0.5rem;">
        <button type="submit" 
                style="background: linear-gradient(135deg, #8B4513 0%, #654321 100%); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(139,69,19,0.3);">
          <i class="fas fa-search" style="margin-right: 0.5rem;"></i>
          Search
        </button>
        {% if selected_location or search_query %}
          <a href="{% url 'portfolio:photographer_list' %}" 
             style="background: #6c757d; color: white; padding: 0.75rem 1rem; border-radius: 12px; text-decoration: none; display: inline-flex; align-items: center; transition: all 0.3s ease;">
            <i class="fas fa-times" style="margin-right: 0.3rem;"></i>
            Clear
          </a>
        {% endif %}
      </div>
    </form>
    
    <!-- Results Info -->
    {% if selected_location or search_query %}
      <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 12px; color: #6c757d; text-align: center;">
        <i class="fas fa-info-circle" style="margin-right: 0.5rem; color: #8B4513;"></i>
        Showing results for:
        {% if search_query %}<strong>"{{ search_query }}"</strong>{% endif %}
        {% if selected_location and search_query %} in {% endif %}
        {% if selected_location %}<strong>{{ selected_location }}</strong>{% endif %}
        ({{ photographers|length }} photographer{{ photographers|length|pluralize }} found)
      </div>
    {% endif %}
  </section>

  <!-- Photographers Grid -->
  <section>
    <div style="text-align: center; margin-bottom: 2.5rem;">
      <h2 style="color: #2c3e50; font-size: 1.8rem; font-weight: 600; margin-bottom: 0.5rem;">
        <i class="fas fa-users" style="margin-right: 0.5rem; color: #8B4513;"></i>
        Meet Our Photographers
      </h2>
      <p style="color: #6c757d; font-size: 1.1rem;">Professional photographers ready to capture your special moments</p>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
      {% for photographer in photographers %}
        <div class="photographer-card" style="background: #fff; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 2rem; text-align: center; transition: all 0.3s ease; position: relative;">
          
          <!-- Profile Picture with Story Ring -->
          <div style="position: relative; width: 150px; margin: 0 auto 1.5rem;">
            {% if photographer.id in photographer_stories %}
              <!-- Has stories - clickable with gold ring -->
              <div onclick="openPhotographerStories({{ photographer.id }}, '{{ photographer.username|escapejs }}', '{% if photographer.profile_picture %}{{ photographer.profile_picture.url }}{% endif %}')" 
                   style="cursor: pointer; position: relative; width: 150px; height: 150px; margin: 0 auto;">
                <div style="position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px; border-radius: 50%; background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700); padding: 3px; animation: pulse 2s infinite;">
                  <div style="width: 100%; height: 100%; border-radius: 50%; background: white; padding: 3px;">
                    {% if photographer.profile_picture %}
                      <img src="{{ photographer.profile_picture.url }}" srcset="{{ photographer.profile_picture.url }} 1x, {{ photographer.profile_picture.url }} 2x" alt="{{ photographer.username }}" 
                           style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                    {% else %}
                      <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #8B4513 0%, #654321 100%); border-radius: 50%; font-size: 2.5rem; color: white; font-weight: 600;">
                        {{ photographer.first_name|first|default:photographer.username|first|upper }}
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% else %}
              <!-- No stories - regular display -->
              {% if photographer.profile_picture %}
                <img src="{{ photographer.profile_picture.url }}" srcset="{{ photographer.profile_picture.url }} 1x, {{ photographer.profile_picture.url }} 2x" alt="Profile Picture" 
                     style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; border: 4px solid #8B4513;">
              {% else %}
                <div style="width: 150px; height: 150px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #8B4513 0%, #654321 100%); border-radius: 50%; font-size: 2.5rem; color: white; font-weight: 600;">
                  {{ photographer.first_name|first|default:photographer.username|first|upper }}
                </div>
              {% endif %}
            {% endif %}
          </div>
          
          <!-- Photographer Info -->
          <h3 style="margin: 0 0 0.5rem;">
            <a href="{% url 'portfolio:photographer_detail' photographer.pk %}" 
               style="color: #2c3e50; font-size: 1.3rem; font-weight: 600; text-decoration: none;">
              {{ photographer.first_name }} {{ photographer.last_name }}
            </a>
          </h3>
          
          <div style="color: #8B4513; font-size: 1rem; font-weight: 500; margin-bottom: 0.5rem;">
            <i class="fas fa-camera" style="margin-right: 0.5rem;"></i>
            {{ photographer.get_role_display }}
          </div>
          
          {% if photographer.location %}
            <div style="color: #6c757d; font-size: 0.9rem; margin-bottom: 1.5rem;">
              <i class="fas fa-map-marker-alt" style="margin-right: 0.5rem;"></i>
              {{ photographer.location }}
            </div>
          {% endif %}
          
          <!-- Action Buttons -->
          <div style="display: flex; gap: 0.5rem; justify-content: center; margin-top: 1.5rem;">
            <a href="{% url 'portfolio:photographer_detail' photographer.pk %}" 
               style="background: linear-gradient(135deg, #8B4513 0%, #654321 100%); color: white; padding: 0.75rem 1.5rem; border-radius: 25px; text-decoration: none; font-weight: 500; transition: all 0.3s ease; display: inline-flex; align-items: center; box-shadow: 0 4px 15px rgba(139,69,19,0.3);">
              <i class="fas fa-eye" style="margin-right: 0.5rem;"></i>
              View Profile
            </a>
            
            <button onclick="copyProfileLink('{{ request.build_absolute_uri }}{% url 'portfolio:photographer_detail' photographer.pk %}')" 
                    style="background: #6c757d; color: white; padding: 0.75rem; border: none; border-radius: 25px; cursor: pointer; transition: all 0.3s ease;">
              <i class="fas fa-share-alt"></i>
            </button>
          </div>
        </div>
      {% empty %}
        <div class="empty-state" style="text-align: center; padding: 5rem 2rem; background: #f8f9fa; border-radius: 20px; grid-column: 1 / -1;">
          <div style="margin-bottom: 2rem;">
            <i class="fas fa-camera-retro" style="font-size: 4rem; color: #e0e0e0;"></i>
          </div>
          
          {% if selected_location or search_query %}
            <h3 style="color: #2c3e50; margin-bottom: 1rem; font-size: 1.8rem;">No Photographers Found</h3>
            <p style="color: #6c757d; margin-bottom: 2rem; font-size: 1.1rem;">
              {% if search_query and selected_location %}
                No photographers match "{{ search_query }}" in {{ selected_location }}.
              {% elif search_query %}
                No photographers match "{{ search_query }}".
              {% elif selected_location %}
                No photographers found in {{ selected_location }}.
              {% endif %}
            </p>
            <a href="{% url 'portfolio:photographer_list' %}" 
               style="background: linear-gradient(135deg, #8B4513 0%, #654321 100%); color: white; padding: 1.25rem 3rem; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; display: inline-flex; align-items: center; box-shadow: 0 6px 20px rgba(139,69,19,0.3); transition: all 0.3s ease;">
              <i class="fas fa-users" style="margin-right: 0.75rem;"></i>
              View All Photographers
            </a>
          {% else %}
            <h3 style="color: #2c3e50; margin-bottom: 1rem; font-size: 1.8rem;">No Photographers Available</h3>
            <p style="color: #6c757d; margin-bottom: 2rem; font-size: 1.1rem;">
              Check back later for new photographers joining our platform.
            </p>
            <a href="{% url 'users:register' %}" 
               style="background: linear-gradient(135deg, #8B4513 0%, #654321 100%); color: white; padding: 1.25rem 3rem; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; display: inline-flex; align-items: center; box-shadow: 0 6px 20px rgba(139,69,19,0.3); transition: all 0.3s ease;">
              <i class="fas fa-user-plus" style="margin-right: 0.75rem;"></i>
              Join as Photographer
            </a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </section>
</div>

<style>
.photographer-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 16px 40px rgba(0,0,0,0.15) !important;
}

.photographer-card:hover img {
  transform: scale(1.05);
  border-color: #654321;
}

.btn-book-photographer:hover {
  background: #fff !important;
  color: #8B4513 !important;
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255,215,0,0.6) !important;
}

input:focus,
select:focus {
  border-color: #8B4513 !important;
  outline: none;
  box-shadow: 0 0 0 3px rgba(139,69,19,0.1);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(139,69,19,0.4) !important;
}

@media (max-width: 768px) {
  .hero-section {
    padding: 3rem 1.5rem !important;
  }
  
  .hero-section h1 {
    font-size: 2.2rem !important;
  }
  
  form {
    grid-template-columns: 1fr !important;
  }
  
  .photographer-card {
    margin: 0 auto;
  }
}

/* Toast notification for copy link */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #10b981;
  color: white;
  padding: 1rem 1.5rem;
  border-radius: 10px;
  font-weight: 500;
  z-index: 10000;
  animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOutRight {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}
</style>

<!-- Hidden story data for JavaScript -->
<script id="story-data" type="application/json">
{
  {% for photographer_id, stories in photographer_stories.items %}
    "{{ photographer_id }}": [
      {% for story in stories %}
        {
          "id": {{ story.id }},
          "mediaUrl": "{% if story.image %}{{ story.image.url }}{% elif story.video %}{{ story.video.url }}{% endif %}",
          "mediaType": "{% if story.image %}image{% else %}video{% endif %}",
          "createdAt": "{{ story.created_at|date:'c' }}"
        }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ]{% if not forloop.last %},{% endif %}
  {% endfor %}
}
</script>

<script>
function copyProfileLink(url) {
  navigator.clipboard.writeText(url).then(function() {
    // Create toast notification
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerHTML = '<i class="fas fa-check-circle" style="margin-right: 0.5rem;"></i>Profile link copied to clipboard!';
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.style.animation = 'slideOutRight 0.3s ease-in';
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }, function() {
    alert('Failed to copy link. Please try again.');
  });
}

// Story Modal Functions
const storyData = JSON.parse(document.getElementById('story-data').textContent);

function getTimeAgo(timestamp) {
    const now = new Date();
    const created = new Date(timestamp);
    const diffMs = now - created;
    const diffSecs = Math.floor(diffMs / 1000);
    const diffMins = Math.floor(diffSecs / 60);
    const diffHours = Math.floor(diffMins / 60);
    const diffDays = Math.floor(diffHours / 24);
    
    if (diffSecs < 60) return diffSecs + 's ago';
    if (diffMins < 60) return diffMins + 'm ago';
    if (diffHours < 24) return diffHours + 'h ago';
    return diffDays + 'd ago';
}

function openPhotographerStories(photographerId, username, avatarUrl) {
    const stories = storyData[photographerId];
    if (!stories || stories.length === 0) return;
    
    const currentIndex = 0;
    const story = stories[currentIndex];
    
    const modal = document.createElement('div');
    modal.id = 'storyModal';
    modal.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 10000; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s ease;">
            <div style="position: relative; max-width: 500px; width: 100%; height: 90vh; display: flex; flex-direction: column;">
                
                <button onclick="closeStoryModal()" style="position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; z-index: 10; transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    <i class="fas fa-times"></i>
                </button>

                ${currentIndex > 0 ? `
                <button onclick="navigateStory(-1)" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); border: none; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; z-index: 10; transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    <i class="fas fa-chevron-left"></i>
                </button>
                ` : ''}

                ${currentIndex < stories.length - 1 ? `
                <button onclick="navigateStory(1)" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); border: none; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; z-index: 10; transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    <i class="fas fa-chevron-right"></i>
                </button>
                ` : ''}

                <div style="position: absolute; top: 0; left: 0; right: 0; padding: 1.5rem; background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent); z-index: 5; display: flex; align-items: center; gap: 1rem;">
                    <img id="storyAvatar" src="${avatarUrl}" srcset="${avatarUrl} 1x, ${avatarUrl} 2x" alt="${username}" style="width: 45px; height: 45px; border-radius: 50%; border: 2px solid #FFD700; object-fit: cover;">
                    <div style="flex: 1;">
                        <div id="storyUsername" style="color: white; font-weight: 600; font-size: 1rem;">${username}</div>
                        <div id="storyTimeAgo" style="color: rgba(255,255,255,0.8); font-size: 0.85rem;">${getTimeAgo(story.createdAt)}</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.5); color: white; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.85rem; backdrop-filter: blur(10px);">
                        <span id="storyCounter">${currentIndex + 1}/${stories.length}</span>
                    </div>
                </div>

                <div style="flex: 1; display: flex; align-items: center; justify-content: center; overflow: hidden; border-radius: 16px; background: #000;">
                    ${story.mediaType === 'image' ? `
                        <img id="storyMedia" src="${story.mediaUrl}" srcset="${story.mediaUrl} 1x, ${story.mediaUrl} 2x" alt="Story" style="max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; transition: opacity 0.3s ease;">
                    ` : `
                        <video id="storyMedia" src="${story.mediaUrl}" autoplay loop muted playsinline style="max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain;">
                            Your browser does not support the video tag.
                        </video>
                    `}
                </div>

                <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 1.5rem; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); z-index: 5; display: flex; gap: 1rem; justify-content: center;">
                    <a href="/portfolio/photographer/${photographerId}/" style="background: #FFD700; color: #1a1a1a; padding: 0.7rem 1.5rem; border-radius: 20px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; transition: all 0.3s ease;">
                        <i class="fas fa-user" style="margin-right: 0.5rem;"></i>
                        View Profile
                    </a>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
    
    window.modalStoriesData = { 
        stories: stories, 
        currentIndex: currentIndex,
        username: username,
        avatarUrl: avatarUrl,
        photographerId: photographerId
    };
}

function navigateStory(direction) {
    const data = window.modalStoriesData;
    if (!data) return;
    
    data.currentIndex += direction;
    const story = data.stories[data.currentIndex];
    
    const media = document.getElementById('storyMedia');
    media.style.opacity = '0';
    
    setTimeout(() => {
        const container = media.parentElement;
        
        if (story.mediaType === 'image') {
            container.innerHTML = `<img id="storyMedia" src="${story.mediaUrl}" srcset="${story.mediaUrl} 1x, ${story.mediaUrl} 2x" alt="Story" style="max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; transition: opacity 0.3s ease;">`;
        } else {
            container.innerHTML = `<video id="storyMedia" src="${story.mediaUrl}" autoplay loop muted playsinline style="max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain;">Your browser does not support the video tag.</video>`;
        }
        
        document.getElementById('storyTimeAgo').textContent = getTimeAgo(story.createdAt);
        document.getElementById('storyCounter').textContent = `${data.currentIndex + 1}/${data.stories.length}`;
        
        const prevBtn = document.querySelector('#storyModal [onclick="navigateStory(-1)"]');
        const nextBtn = document.querySelector('#storyModal [onclick="navigateStory(1)"]');
        
        if (prevBtn) prevBtn.style.display = data.currentIndex > 0 ? 'flex' : 'none';
        if (nextBtn) nextBtn.style.display = data.currentIndex < data.stories.length - 1 ? 'flex' : 'none';
        
        const newMedia = document.getElementById('storyMedia');
        setTimeout(() => newMedia.style.opacity = '1', 50);
    }, 300);
}

function closeStoryModal() {
    const modal = document.getElementById('storyModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
        window.modalStoriesData = null;
    }
}

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && window.modalStoriesData) {
        closeStoryModal();
    } else if (e.key === 'ArrowLeft' && window.modalStoriesData && window.modalStoriesData.currentIndex > 0) {
        navigateStory(-1);
    } else if (e.key === 'ArrowRight' && window.modalStoriesData && window.modalStoriesData.currentIndex < window.modalStoriesData.stories.length - 1) {
        navigateStory(1);
    }
});
</script>
{% endblock %}
