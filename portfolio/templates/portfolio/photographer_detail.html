{% extends 'base.html' %}
{% block content %}
<div style="display:flex;justify-content:flex-end;max-width:900px;margin:2rem auto 0 auto;padding:0 2.5rem 0 2.5rem;">
  <a href="/bookings/create/?photographer={{ photographer.pk }}" style="background:#ffd700;color:#2d2013;padding:0.7rem 2rem;border-radius:1.2rem;font-weight:700;text-decoration:none;box-shadow:0 2px 8px rgba(199,161,122,0.13);transition:all 0.2s;">Book this Photographer</a>
  <button type="button" onclick="copyProfileLink()" style="margin-left:1rem;background:#c7a17a;color:#fff;padding:0.7rem 2rem;border-radius:1.2rem;font-weight:700;box-shadow:0 2px 8px rgba(199,161,122,0.13);border:none;cursor:pointer;transition:all 0.2s;z-index:2;position:relative;">Share Profile</button>
  <div style="margin-left:1rem;display:flex;gap:0.5rem;align-items:center;">
    <button type="button" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(window.location.href),'_blank')" style="background:#4267B2;color:#fff;padding:0.35rem 0.8rem;border-radius:50%;font-size:1.2rem;box-shadow:0 2px 8px rgba(199,161,122,0.13);border:none;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;" title="Share on Facebook">
      <i class="fab fa-facebook-f"></i>
    </button>
    <button type="button" onclick="window.open('https://twitter.com/intent/tweet?url='+encodeURIComponent(window.location.href),'_blank')" style="background:#1DA1F2;color:#fff;padding:0.35rem 0.8rem;border-radius:50%;font-size:1.2rem;box-shadow:0 2px 8px rgba(199,161,122,0.13);border:none;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;" title="Share on Twitter">
      <i class="fab fa-twitter"></i>
    </button>
    <button type="button" onclick="window.open('https://wa.me/?text='+encodeURIComponent(window.location.href),'_blank')" style="background:#25D366;color:#fff;padding:0.35rem 0.8rem;border-radius:50%;font-size:1.2rem;box-shadow:0 2px 8px rgba(199,161,122,0.13);border:none;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;" title="Share on WhatsApp">
      <i class="fab fa-whatsapp"></i>
    </button>
    <button type="button" onclick="window.open('https://www.instagram.com/?url='+encodeURIComponent(window.location.href),'_blank')" style="background:#E1306C;color:#fff;padding:0.35rem 0.8rem;border-radius:50%;font-size:1.2rem;box-shadow:0 2px 8px rgba(199,161,122,0.13);border:none;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;" title="Share on Instagram">
      <i class="fab fa-instagram"></i>
    </button>
    <button type="button" onclick="window.open('https://www.youtube.com/share?url='+encodeURIComponent(window.location.href),'_blank')" style="background:#FF0000;color:#fff;padding:0.35rem 0.8rem;border-radius:50%;font-size:1.2rem;box-shadow:0 2px 8px rgba(199,161,122,0.13);border:none;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;" title="Share on YouTube">
      <i class="fab fa-youtube"></i>
    </button>
  </div>
</div>
<div class="profile-hero" style="background:linear-gradient(120deg,#fffbe6 0%,#f8f6f3 100%);padding:2.5rem 0 1.5rem 0;">
  <div class="profile-card" style="max-width:900px;margin:0 auto;background:#fff;border-radius:2rem;box-shadow:0 8px 32px rgba(199,161,122,0.10);padding:2.5rem 2.5rem 2rem 2.5rem;display:flex;gap:2.5rem;align-items:center;">
    <div style="flex:0 0 180px;text-align:center;">
      {% if photographer.profile_picture %}
        <img src="{{ photographer.profile_picture.url }}" srcset="{{ photographer.profile_picture.url }} 1x, {{ photographer.profile_picture.url }} 2x" alt="Profile Picture" style="width:200px;height:200px;object-fit:cover;border-radius:50%;border:4px solid #ffd700;box-shadow:0 2px 12px rgba(199,161,122,0.12);">
      {% else %}
        <div style="width:150px;height:150px;display:flex;align-items:center;justify-content:center;background:#f8f6f3;border-radius:50%;border:4px solid #ffd700;font-size:3rem;color:#a67c52;">{{ photographer.first_name|first|default:photographer.username|first|upper }}</div>
      {% endif %}
      <div style="margin-top:1rem;font-size:1.1rem;color:#a67c52;font-weight:600;">{{ photographer.get_role_display }}</div>
    </div>
    <div style="flex:1;">
      <h2 style="font-size:2.2rem;font-weight:800;color:#2d2013;margin-bottom:0.5rem;">{{ photographer.first_name }} {{ photographer.last_name }}</h2>
      <div style="color:#6b6b6b;font-size:1.1rem;margin-bottom:1.2rem;">{{ photographer.bio }}</div>
      <div style="margin-bottom:0.7rem;"><strong style="color:#a67c52;">Location:</strong> {{ photographer.location }}</div>
      <div style="margin-bottom:0.7rem;"><strong style="color:#a67c52;">Contact:</strong> {{ photographer.contact_info }}</div>
      <div style="margin-bottom:0.7rem;"><strong style="color:#a67c52;">Email:</strong> {{ photographer.email }}</div>
      {% if user.is_authenticated and user.role == 'client' %}
        <a href="{% url 'create_booking' %}?photographer={{ photographer.pk }}" class="book-btn" style="display:inline-block;margin-top:1.2rem;background:linear-gradient(90deg,#ffd700 0%,#c7a17a 100%);color:#2d2013;padding:0.75rem 2rem;border-radius:1rem;font-weight:bold;text-decoration:none;box-shadow:0 2px 8px rgba(199,161,122,0.10);">Book this Photographer</a>
      {% endif %}
    </div>
  </div>
</div>

<!-- Stories Section (always public, no time info) -->
{% if stories %}
<div style="max-width:900px;margin:2.5rem auto 0 auto;">
  <div style="display:flex;gap:1.2rem;align-items:flex-end;overflow-x:auto;padding-bottom:0.7rem;">
    {% for story in stories %}
      <div style="flex:0 0 110px;text-align:center;">
        <div style="width:120px;height:120px;border-radius:50%;border:3px solid #ffd700;overflow:hidden;box-shadow:0 2px 8px rgba(199,161,122,0.13);margin:0 auto 0.5rem auto;background:#fffbe6;display:flex;align-items:center;justify-content:center;">
          {% if story.image %}
            <img src="{{ story.image.url }}" srcset="{{ story.image.url }} 1x, {{ story.image.url }} 2x" alt="Story" style="width:100%;height:100%;object-fit:cover;">
          {% else %}
            <i class="fas fa-image" style="font-size:2rem;color:#a67c52;"></i>
          {% endif %}
        </div>
        <div style="font-size:0.97rem;color:#a67c52;font-weight:600;">Story</div>
      </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<div style="max-width:900px;margin:2.5rem auto 0 auto;">
  <h3 style="font-size:1.5rem;color:#c7a17a;font-weight:700;margin-bottom:1.2rem;">Upcoming Events</h3>
  <div style="display:flex;flex-wrap:wrap;gap:1.5rem;">
    {% for event in events %}
      <div style="background:#fffbe6;border-radius:1.2rem;box-shadow:0 2px 8px rgba(199,161,122,0.07);padding:1.2rem 1.5rem;min-width:220px;flex:1 1 260px;max-width:320px;">
        {% if event.image %}
          <img src="{{ event.image.url }}" srcset="{{ event.image.url }} 1x, {{ event.image.url }} 2x" alt="{{ event.title }} cover" style="width:100%;max-width:340px;height:auto;max-height:220px;object-fit:cover;border-radius:0.8rem;margin-bottom:0.7rem;box-shadow:0 2px 8px rgba(199,161,122,0.10);cursor:pointer;" onclick="showEventModal('image', '{{ event.image.url }}', '{{ event.title|escapejs }}')">
        {% endif %}
        {% if event.video %}
          <div style="position:relative;width:100%;max-width:260px;height:140px;margin-bottom:0.7rem;">
            <video src="{{ event.video.url }}" style="width:100%;height:100%;object-fit:cover;border-radius:0.8rem;box-shadow:0 2px 8px rgba(199,161,122,0.10);cursor:pointer;" onclick="showEventModal('video', '{{ event.video.url }}', '{{ event.title|escapejs }}')" preload="metadata"></video>
            <span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2.2rem;color:#fff;background:rgba(0,0,0,0.4);border-radius:50%;padding:0.2em 0.4em;pointer-events:none;">&#9658;</span>
          </div>
        {% endif %}
        <div style="font-weight:700;color:#2d2013;font-size:1.1rem;">{{ event.title }}</div>
        <div style="color:#a67c52;font-size:1rem;margin-bottom:0.3rem;">{{ event.date }}</div>
        <div style="color:#6b6b6b;font-size:0.98rem;margin-bottom:0.3rem;">{{ event.location }}</div>
        <div style="color:#444;font-size:0.97rem;">{{ event.description|truncatewords:18 }}
          {% if event.description|length > 120 %}
            <button onclick="showEventDescModal('{{ event.pk }}', '{{ event.title|escapejs }}', `{{ event.description|escapejs }}`, '{% if event.image %}{{ event.image.url }}{% else %}{% endif %}', '{% if event.video %}{{ event.video.url }}{% else %}{% endif %}')" style="background:none;border:none;color:#c7a17a;font-weight:600;cursor:pointer;margin-left:0.5em;">View more</button>
          {% endif %}
        </div>
<!-- Event Description Modal (with cover and video) -->
<div id="eventDescModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;">
  <span onclick="closeEventDescModal()" style="position:absolute;top:30px;right:50px;font-size:2.5rem;color:#fff;cursor:pointer;font-weight:bold;">&times;</span>
  <div style="background:#fffbe6;padding:2.2rem 2.5rem;border-radius:1.2rem;max-width:90vw;width:100%;max-height:80vh;overflow-y:auto;margin:0 auto;box-shadow:0 4px 32px rgba(0,0,0,0.18);text-align:center;">
    <img id="eventDescModalCover" src="" alt="Event Cover" style="max-width:100%;max-height:220px;border-radius:1rem;margin-bottom:1.2rem;display:none;object-fit:cover;box-shadow:0 2px 8px rgba(199,161,122,0.10);">
  <video id="eventDescModalVideo" src="" controls style="max-width:100%;max-height:220px;border-radius:1rem;margin-bottom:1.2rem;display:none;background:#000;"></video>
<style>
#eventDescModalCover {
  width: 100% !important;
  height: auto !important;
  max-height: 340px;
  object-fit: cover !important;
  border-radius: 1rem;
  margin-bottom: 1.2rem;
  box-shadow: 0 2px 8px rgba(199,161,122,0.10);
  display: none;
}
</style>
  <div id="eventDescModalTitle" style="color:#2d2013;text-align:center;font-size:1.7rem;margin:1.2rem 0 1.2rem 0;font-weight:800;letter-spacing:0.5px;"></div>
    <div id="eventDescModalBody" style="color:#444;font-size:1.08rem;line-height:1.7;word-break:break-word;"></div>
  </div>
</div>
<script>
function showEventDescModal(pk, title, desc, coverUrl, videoUrl) {
  var modal = document.getElementById('eventDescModal');
  var modalTitle = document.getElementById('eventDescModalTitle');
  var modalBody = document.getElementById('eventDescModalBody');
  var modalCover = document.getElementById('eventDescModalCover');
  var modalVideo = document.getElementById('eventDescModalVideo');
  modal.style.display = 'flex';
  modalTitle.textContent = title;
  modalBody.textContent = desc;
  if(coverUrl) {
    modalCover.src = coverUrl;
    modalCover.style.display = 'block';
  } else {
    modalCover.style.display = 'none';
    modalCover.src = '';
  }
  if(videoUrl) {
    modalVideo.src = videoUrl;
    modalVideo.style.display = 'block';
  } else {
    modalVideo.style.display = 'none';
    modalVideo.src = '';
  }
  document.body.style.overflow = 'hidden';
}
function closeEventDescModal() {
  var modal = document.getElementById('eventDescModal');
  var modalVideo = document.getElementById('eventDescModalVideo');
  modal.style.display = 'none';
  document.body.style.overflow = '';
  modalVideo.pause();
  modalVideo.src = '';
}
window.onclick = function(event) {
  var modal = document.getElementById('eventDescModal');
  if (event.target == modal) {
    closeEventDescModal();
  }
}
</script>
      </div>
<!-- Event Media Modal -->
<div id="eventModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;">
  <span onclick="closeEventModal()" style="position:absolute;top:30px;right:50px;font-size:2.5rem;color:#fff;cursor:pointer;font-weight:bold;">&times;</span>
  <img id="eventModalImg" src="" alt="Event Cover" style="max-width:90vw;max-height:80vh;border-radius:1.2rem;box-shadow:0 4px 32px rgba(0,0,0,0.25);display:none;margin:0 auto;">
  <video id="eventModalVideo" src="" controls style="max-width:90vw;max-height:80vh;border-radius:1.2rem;box-shadow:0 4px 32px rgba(0,0,0,0.25);display:none;margin:0 auto;background:#000;"></video>
  <div id="eventModalTitle" style="color:#fff;text-align:center;font-size:1.5rem;margin-top:1.2rem;font-weight:700;"></div>
</div>
<script>
function showEventModal(type, url, title) {
  var modal = document.getElementById('eventModal');
  var modalImg = document.getElementById('eventModalImg');
  var modalVideo = document.getElementById('eventModalVideo');
  var modalTitle = document.getElementById('eventModalTitle');
  modal.style.display = 'flex';
  if(type === 'image') {
    modalImg.src = url;
    modalImg.style.display = 'block';
    modalVideo.style.display = 'none';
    modalVideo.pause();
    modalVideo.src = '';
  } else if(type === 'video') {
    modalVideo.src = url;
    modalVideo.style.display = 'block';
    modalImg.style.display = 'none';
    modalImg.src = '';
  }
  modalTitle.textContent = title;
  document.body.style.overflow = 'hidden';
}
function closeEventModal() {
  var modal = document.getElementById('eventModal');
  var modalVideo = document.getElementById('eventModalVideo');
  modal.style.display = 'none';
  document.body.style.overflow = '';
  modalVideo.pause();
  modalVideo.src = '';
}
window.onclick = function(event) {
  var modal = document.getElementById('eventModal');
  if (event.target == modal) {
    closeEventModal();
  }
}
</script>
    {% empty %}
      <div style="color:#888;">No upcoming events.</div>
    {% endfor %}
  </div>

  <h3 style="font-size:1.5rem;color:#c7a17a;font-weight:700;margin:2.5rem 0 1.2rem 0;">Portfolio Photos</h3>
  <div style="display:flex;flex-wrap:wrap;gap:1.5rem;">
    {% for photo in photos %}
      {% if photo.is_approved or user.is_authenticated and user == photographer or user.is_superuser %}
        {% if user.is_authenticated %}
          <a href="{% url 'community:report_content' 'photo' photo.pk %}" style="color:#e53935;font-size:0.98rem;font-weight:600;float:right;">Report</a>
        {% endif %}
        <div style="background:#fff;border-radius:1.2rem;box-shadow:0 2px 8px rgba(199,161,122,0.07);padding:1.2rem 1.5rem;min-width:220px;flex:1 1 260px;max-width:320px;text-align:center;position:relative;">
          {% if not photo.is_approved %}
            <div style="background:#ff9800;color:#fff;padding:0.2rem 0.5rem;border-radius:0.5rem;font-size:0.8rem;font-weight:600;position:absolute;top:0.5rem;right:0.5rem;z-index:1;">Pending Approval</div>
          {% endif %}
          {% if photo.image %}
            <img src="{{ photo.image.url }}" srcset="{{ photo.image.url }} 1x, {{ photo.image.url }} 2x" alt="{{ photo.title }}" style="width:100%;max-width:340px;height:auto;max-height:280px;object-fit:cover;border-radius:1rem;margin-bottom:0.7rem;box-shadow:0 2px 8px rgba(199,161,122,0.10);">
          {% else %}
            <div style="width:100%;max-width:260px;height:180px;background:#f8f6f3;border-radius:1rem;margin-bottom:0.7rem;box-shadow:0 2px 8px rgba(199,161,122,0.10);display:flex;align-items:center;justify-content:center;border:2px dashed #c7a17a;">
              <i class="fas fa-image" style="font-size:3rem;color:#a67c52;"></i>
            </div>
          {% endif %}
          <div style="font-weight:700;color:#2d2013;font-size:1.1rem;">{{ photo.title }}</div>
          <div style="color:#a67c52;font-size:1rem;margin-bottom:0.3rem;">{{ photo.category }}</div>
          <div style="color:#444;font-size:0.97rem;">{{ photo.description|truncatewords:18 }}</div>
          {% if user.is_authenticated and user == photo.photographer or user.is_superuser %}
            <form method="post" action="{% url 'portfolio:delete_photo' photo.id %}" style="margin-top:0.7rem;">
              {% csrf_token %}
              <button type="submit" style="background:#e74c3c;color:#fff;padding:0.4rem 1.2rem;border:none;border-radius:0.7rem;font-weight:700;">Delete</button>
            </form>
          {% endif %}
        </div>
      {% endif %}
    {% empty %}
      <div style="color:#888;">No photos yet.</div>
    {% endfor %}
  </div>
</div>

<!-- Reviews Section -->
<div style="max-width:900px;margin:3rem auto;background:white;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.08);overflow:hidden;">
  <div style="background:linear-gradient(135deg,#a67c52 0%,#8b6332 100%);color:white;padding:1.5rem;display:flex;justify-content:space-between;align-items:center;">
    <div>
      <h3 style="font-size:1.5rem;font-weight:700;margin:0 0 0.3rem 0;">Customer Reviews</h3>
      {% if avg_rating %}
        <div style="display:flex;align-items:center;gap:0.5rem;">
          <div style="display:flex;align-items:center;">
            {% for i in "12345" %}
              {% if forloop.counter <= avg_rating|floatformat:0 %}
                <span style="color:#ffd700;font-size:1rem;">★</span>
              {% else %}
                <span style="color:rgba(255,255,255,0.3);font-size:1rem;">★</span>
              {% endif %}
            {% endfor %}
          </div>
          <span style="font-size:0.9rem;opacity:0.9;">{{ avg_rating|floatformat:1 }} average ({{ review_count }} review{{ review_count|pluralize }})</span>
        </div>
      {% endif %}
    </div>
    {% if reviews %}
      <a href="{% url 'reviews:reviews_list' %}?photographer={{ photographer.id }}" style="color:white;text-decoration:none;font-size:0.9rem;opacity:0.9;">View All Reviews →</a>
    {% endif %}
  </div>
  
  <div style="padding:2rem;">
    {% if reviews %}
      {% for review in reviews|slice:":3" %}
        <div style="{% if not forloop.last %}border-bottom:1px solid #eee;padding-bottom:1.5rem;margin-bottom:1.5rem;{% endif %}">
          <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:0.5rem;">
            <div style="display:flex;align-items:center;gap:0.5rem;">
              <strong style="color:#2d2013;">
                {% if review.reviewer %}
                  {{ review.reviewer.get_full_name|default:review.reviewer.username }}
                {% else %}
                  {{ review.anonymous_name }}
                {% endif %}
              </strong>
              <div>
                {% for i in "12345" %}
                  {% if forloop.counter <= review.overall_rating %}
                    <span style="color:#ffd700;font-size:0.9rem;">★</span>
                  {% else %}
                    <span style="color:#ddd;font-size:0.9rem;">★</span>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            <small style="color:#666;">{{ review.created_at|date:"M d, Y" }}</small>
          </div>
          
          {% if review.booking %}
            <div style="margin-bottom:0.5rem;">
              <span style="background:#ffd700;color:#2d2013;padding:0.2rem 0.5rem;border-radius:12px;font-size:0.75rem;font-weight:600;">
                {{ review.booking.get_service_type_display }}
              </span>
            </div>
          {% endif %}
          
          <p style="color:#444;line-height:1.5;margin-bottom:0.5rem;">"{{ review.comment|truncatewords:25 }}"</p>
          
          {% if review.comment|length > 150 %}
            <a href="{% url 'reviews:review_detail' review.id %}" style="color:#a67c52;text-decoration:none;font-size:0.85rem;font-weight:600;">
              Read More →
            </a>
          {% endif %}
        </div>
      {% endfor %}
      
      <div style="text-align:center;margin-top:1.5rem;">
        <a href="{% url 'reviews:reviews_list' %}?photographer={{ photographer.id }}" style="background:#a67c52;color:white;padding:0.75rem 1.5rem;border-radius:25px;text-decoration:none;font-weight:600;">
          View All Reviews ({{ review_count }})
        </a>
        {% if user.is_authenticated and user != photographer %}
          <a href="{% url 'reviews:add_review' %}?photographer={{ photographer.id }}" style="background:transparent;color:#a67c52;border:2px solid #a67c52;padding:0.7rem 1.5rem;border-radius:25px;text-decoration:none;font-weight:600;margin-left:1rem;">
            ✍️ Write a Review
          </a>
        {% endif %}
      </div>
    {% else %}
      <div style="text-align:center;padding:2rem;">
        <p style="color:#666;margin-bottom:1rem;">No reviews yet. Be the first to share your experience!</p>
        {% if user.is_authenticated and user != photographer %}
          <a href="{% url 'reviews:add_review' %}?photographer={{ photographer.id }}" style="background:#a67c52;color:white;padding:1rem 2rem;border-radius:25px;text-decoration:none;font-weight:600;">
            ✍️ Write the First Review
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

<script>
function copyProfileLink() {
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(function() {
    alert('Profile link copied to clipboard!');
  }, function() {
    alert('Failed to copy link.');
  });
}
</script>
{% endblock %}
