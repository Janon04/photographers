{% extends 'admin_dashboard/base_admin.html' %}

{% block title %}Bookings Management{% endblock %}
{% block page_title %}Bookings Management{% endblock %}

{% block content %}

<!-- Payment Statistics Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 32px;">
    
    <!-- Total Paid Card -->
    <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.05) 100%); border-radius: 20px; padding: 28px; border: 2px solid rgba(34, 197, 94, 0.3); box-shadow: 0 10px 30px rgba(34, 197, 94, 0.2); position: relative; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(34, 197, 94, 0.35)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(34, 197, 94, 0.2)';">
        <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(34, 197, 94, 0.2) 0%, transparent 70%); border-radius: 50%;"></div>
        
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, #22C55E, #16A34A); width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);">
                <i class="fas fa-check-circle" style="font-size: 28px; color: white;"></i>
            </div>
            <div style="text-align: right;">
                <p style="color: rgba(224, 231, 255, 0.6); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 0;">Total Paid</p>
            </div>
        </div>
        
        <div style="margin-bottom: 16px;">
            <h2 style="color: #22C55E; font-weight: 900; font-size: 42px; margin: 0; line-height: 1; text-shadow: 0 2px 10px rgba(34, 197, 94, 0.3);">{{ total_paid|floatformat:0|default:"0" }}</h2>
            <p style="color: rgba(34, 197, 94, 0.8); font-size: 14px; font-weight: 600; margin: 4px 0 0 0;">RWF</p>
        </div>
        
        <div style="display: inline-flex; align-items: center; background: rgba(34, 197, 94, 0.2); padding: 8px 16px; border-radius: 30px; border: 1px solid rgba(34, 197, 94, 0.3);">
            <i class="fas fa-calendar-check" style="color: #22C55E; font-size: 14px; margin-right: 8px;"></i>
            <span style="color: #22C55E; font-size: 14px; font-weight: 700;">{{ paid_count|default:"0" }} bookings</span>
        </div>
    </div>
    
    <!-- Pending Payments Card -->
    <div style="background: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(251, 146, 60, 0.05) 100%); border-radius: 20px; padding: 28px; border: 2px solid rgba(251, 146, 60, 0.3); box-shadow: 0 10px 30px rgba(251, 146, 60, 0.2); position: relative; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(251, 146, 60, 0.35)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(251, 146, 60, 0.2)';">
        <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(251, 146, 60, 0.2) 0%, transparent 70%); border-radius: 50%;"></div>
        
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, #FB923C, #F97316); width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(251, 146, 60, 0.4);">
                <i class="fas fa-clock" style="font-size: 28px; color: white;"></i>
            </div>
            <div style="text-align: right;">
                <p style="color: rgba(224, 231, 255, 0.6); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 0;">Pending</p>
            </div>
        </div>
        
        <div style="margin-bottom: 16px;">
            <h2 style="color: #FB923C; font-weight: 900; font-size: 42px; margin: 0; line-height: 1; text-shadow: 0 2px 10px rgba(251, 146, 60, 0.3);">{{ total_pending|floatformat:0|default:"0" }}</h2>
            <p style="color: rgba(251, 146, 60, 0.8); font-size: 14px; font-weight: 600; margin: 4px 0 0 0;">RWF</p>
        </div>
        
        <div style="display: inline-flex; align-items: center; background: rgba(251, 146, 60, 0.2); padding: 8px 16px; border-radius: 30px; border: 1px solid rgba(251, 146, 60, 0.3);">
            <i class="fas fa-hourglass-half" style="color: #FB923C; font-size: 14px; margin-right: 8px;"></i>
            <span style="color: #FB923C; font-size: 14px; font-weight: 700;">{{ pending_count|default:"0" }} bookings</span>
        </div>
    </div>
    
    <!-- Failed Payments Card -->
    <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); border-radius: 20px; padding: 28px; border: 2px solid rgba(239, 68, 68, 0.3); box-shadow: 0 10px 30px rgba(239, 68, 68, 0.2); position: relative; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(239, 68, 68, 0.35)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(239, 68, 68, 0.2)';">
        <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(239, 68, 68, 0.2) 0%, transparent 70%); border-radius: 50%;"></div>
        
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, #EF4444, #DC2626); width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);">
                <i class="fas fa-times-circle" style="font-size: 28px; color: white;"></i>
            </div>
            <div style="text-align: right;">
                <p style="color: rgba(224, 231, 255, 0.6); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 0;">Failed</p>
            </div>
        </div>
        
        <div style="margin-bottom: 16px;">
            <h2 style="color: #EF4444; font-weight: 900; font-size: 42px; margin: 0; line-height: 1; text-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);">{{ total_failed|floatformat:0|default:"0" }}</h2>
            <p style="color: rgba(239, 68, 68, 0.8); font-size: 14px; font-weight: 600; margin: 4px 0 0 0;">RWF</p>
        </div>
        
        <div style="display: inline-flex; align-items: center; background: rgba(239, 68, 68, 0.2); padding: 8px 16px; border-radius: 30px; border: 1px solid rgba(239, 68, 68, 0.3);">
            <i class="fas fa-exclamation-triangle" style="color: #EF4444; font-size: 14px; margin-right: 8px;"></i>
            <span style="color: #EF4444; font-size: 14px; font-weight: 700;">{{ failed_count|default:"0" }} bookings</span>
        </div>
    </div>
    
    <!-- Payment Methods Card -->
    <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(168, 85, 247, 0.05) 100%); border-radius: 20px; padding: 28px; border: 2px solid rgba(168, 85, 247, 0.3); box-shadow: 0 10px 30px rgba(168, 85, 247, 0.2); position: relative; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(168, 85, 247, 0.35)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(168, 85, 247, 0.2)';">
        <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(168, 85, 247, 0.2) 0%, transparent 70%); border-radius: 50%;"></div>
        
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, #A855F7, #9333EA); width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(168, 85, 247, 0.4);">
                <i class="fas fa-credit-card" style="font-size: 28px; color: white;"></i>
            </div>
            <div style="text-align: right;">
                <p style="color: rgba(224, 231, 255, 0.6); font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 0;">Payment Methods</p>
            </div>
        </div>
        
        <div style="margin-bottom: 16px;">
            <h2 style="color: #A855F7; font-weight: 900; font-size: 42px; margin: 0; line-height: 1; text-shadow: 0 2px 10px rgba(168, 85, 247, 0.3);">{{ payment_methods|length|default:"0" }}</h2>
            <p style="color: rgba(168, 85, 247, 0.8); font-size: 14px; font-weight: 600; margin: 4px 0 0 0;">Methods Used</p>
        </div>
        
        <div style="max-height: 80px; overflow-y: auto; padding-right: 8px;">
            {% for method in payment_methods %}
            <div style="display: flex; align-items: center; justify-content: space-between; background: rgba(168, 85, 247, 0.15); padding: 8px 12px; border-radius: 10px; margin-bottom: 6px; border: 1px solid rgba(168, 85, 247, 0.25);">
                <span style="color: #A855F7; font-size: 13px; font-weight: 600; text-transform: capitalize;">
                    {% if 'card' in method.payment_method %}<i class="fas fa-credit-card me-2"></i>{% endif %}
                    {% if 'mobile' in method.payment_method %}<i class="fas fa-mobile-alt me-2"></i>{% endif %}
                    {% if 'paypal' in method.payment_method %}<i class="fab fa-paypal me-2"></i>{% endif %}
                    {% if 'bank' in method.payment_method %}<i class="fas fa-university me-2"></i>{% endif %}
                    {{ method.payment_method }}
                </span>
                <span style="background: rgba(168, 85, 247, 0.3); color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 700;">{{ method.count }}</span>
            </div>
            {% empty %}
            <div style="text-align: center; padding: 12px; color: rgba(224, 231, 255, 0.5); font-size: 13px;">
                <i class="fas fa-info-circle me-2"></i>No payment methods used yet
            </div>
            {% endfor %}
        </div>
    </div>
    
</div>

<!-- Date Filter Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="content-card" style="background: linear-gradient(135deg, var(--chocolate-dark), var(--chocolate-medium)); color: white; border: 2px solid var(--yellow);">
            <form method="get" class="d-flex align-items-center gap-3 flex-wrap">
                <!-- Preserve other filters -->
                {% if search_query %}
                    <input type="hidden" name="search" value="{{ search_query }}">
                {% endif %}
                {% if status_filter %}
                    <input type="hidden" name="status" value="{{ status_filter }}">
                {% endif %}
                {% if payment_filter %}
                    <input type="hidden" name="payment" value="{{ payment_filter }}">
                {% endif %}
                
                <label for="filter_date" class="form-label mb-0" style="color: var(--yellow); font-weight: 700;">Filter by Date:</label>
                <input type="date" class="form-control" id="filter_date" name="filter_date" 
                       value="{{ filter_date }}" style="max-width: 200px; background: white; color: var(--chocolate-dark);">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-filter me-1"></i> Apply Filter
                </button>
                {% if filter_date %}
                    <a href="{% url 'admin_dashboard:bookings_management' %}" class="btn btn-danger">
                        <i class="fas fa-times me-1"></i> Clear Filter
                    </a>
                {% endif %}
            </form>
        </div>
    </div>
</div>

<!-- Search and Filter Section -->
<div style="background: linear-gradient(135deg, rgba(26, 31, 58, 0.9) 0%, rgba(10, 14, 39, 0.95) 100%); border-radius: 16px; padding: 28px; margin-bottom: 24px; box-shadow: 0 0 40px rgba(0, 217, 255, 0.2), inset 0 0 20px rgba(0, 217, 255, 0.05); border: 1px solid var(--neon-blue);">
    <form method="get">
        <!-- Preserve date filter -->
        {% if filter_date %}
            <input type="hidden" name="filter_date" value="{{ filter_date }}">
        {% endif %}
        
        <div class="row g-3">
            <div class="col-lg-4 col-md-6">
                <label for="search" style="display: block; font-size: 12px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; text-shadow: 0 0 10px rgba(0, 217, 255, 0.4);">
                    <i class="fas fa-search me-1"></i>Search Bookings
                </label>
                <input type="text" class="form-control" id="search" name="search" 
                       value="{{ search_query }}" placeholder="Client, photographer, service, location..."
                       style="background: rgba(10, 14, 39, 0.8); border: 2px solid var(--neon-blue); color: var(--neon-cyan); font-weight: 500; padding: 12px 16px; border-radius: 10px; box-shadow: 0 0 15px rgba(0, 217, 255, 0.15); transition: all 0.3s ease;"
                       onfocus="this.style.boxShadow='0 0 25px rgba(0, 217, 255, 0.4)'; this.style.borderColor='var(--neon-cyan)';"
                       onblur="this.style.boxShadow='0 0 15px rgba(0, 217, 255, 0.15)'; this.style.borderColor='var(--neon-blue)';">
            </div>
            <div class="col-lg-2 col-md-6">
                <label for="status" style="display: block; font-size: 12px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; text-shadow: 0 0 10px rgba(0, 217, 255, 0.4);">
                    <i class="fas fa-tasks me-1"></i>Status
                </label>
                <select class="form-select" id="status" name="status"
                        style="background: rgba(10, 14, 39, 0.8); border: 2px solid var(--neon-blue); color: var(--neon-cyan); font-weight: 500; padding: 12px 16px; border-radius: 10px; box-shadow: 0 0 15px rgba(0, 217, 255, 0.15); transition: all 0.3s ease;"
                        onfocus="this.style.boxShadow='0 0 25px rgba(0, 217, 255, 0.4)'; this.style.borderColor='var(--neon-cyan)';"
                        onblur="this.style.boxShadow='0 0 15px rgba(0, 217, 255, 0.15)'; this.style.borderColor='var(--neon-blue)';">
                    <option value="" style="background: #0A0E27; color: var(--neon-cyan);">All Statuses</option>
                    {% for value, label in booking_statuses %}
                        <option value="{{ value }}" {% if status_filter == value %}selected{% endif %} style="background: #0A0E27; color: var(--neon-cyan);">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-lg-2 col-md-6">
                <label for="payment" style="display: block; font-size: 12px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; text-shadow: 0 0 10px rgba(0, 217, 255, 0.4);">
                    <i class="fas fa-credit-card me-1"></i>Payment
                </label>
                <select class="form-select" id="payment" name="payment"
                        style="background: rgba(10, 14, 39, 0.8); border: 2px solid var(--neon-blue); color: var(--neon-cyan); font-weight: 500; padding: 12px 16px; border-radius: 10px; box-shadow: 0 0 15px rgba(0, 217, 255, 0.15); transition: all 0.3s ease;"
                        onfocus="this.style.boxShadow='0 0 25px rgba(0, 217, 255, 0.4)'; this.style.borderColor='var(--neon-cyan)';"
                        onblur="this.style.boxShadow='0 0 15px rgba(0, 217, 255, 0.15)'; this.style.borderColor='var(--neon-blue)';">
                    <option value="" style="background: #0A0E27; color: var(--neon-cyan);">All Payments</option>
                    {% for value, label in payment_statuses %}
                        <option value="{{ value }}" {% if payment_filter == value %}selected{% endif %} style="background: #0A0E27; color: var(--neon-cyan);">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-lg-4 col-md-6">
                <label style="display: block; font-size: 12px; font-weight: 700; color: transparent; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px;">Action</label>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn flex-grow-1" style="background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue)); color: var(--bg-darker); border: none; font-weight: 700; padding: 12px 20px; border-radius: 10px; box-shadow: 0 0 25px rgba(0, 217, 255, 0.4); transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; font-size: 13px;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 0 35px rgba(0, 217, 255, 0.6)';"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 0 25px rgba(0, 217, 255, 0.4)';">
                        <i class="fas fa-search me-2"></i>Search
                    </button>
                    <a href="{% url 'admin_dashboard:export_data' %}?type=bookings" class="btn" style="background: linear-gradient(135deg, var(--neon-green), #2DD97F); color: var(--bg-darker); border: none; font-weight: 700; padding: 12px 20px; border-radius: 10px; box-shadow: 0 0 25px rgba(57, 255, 20, 0.4); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 0 35px rgba(57, 255, 20, 0.6)';"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 0 25px rgba(57, 255, 20, 0.4)';">
                        <i class="fas fa-download"></i>
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Bookings Table -->
<div style="background: linear-gradient(135deg, rgba(26, 31, 58, 0.9) 0%, rgba(10, 14, 39, 0.95) 100%); border-radius: 16px; overflow: hidden; box-shadow: 0 0 40px rgba(0, 217, 255, 0.25), inset 0 0 20px rgba(0, 217, 255, 0.08); border: 1px solid var(--neon-blue);">
    <div style="background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-cyan) 100%); padding: 20px 28px; border-bottom: 4px solid var(--neon-cyan); box-shadow: 0 4px 15px rgba(0, 217, 255, 0.2);">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <h5 style="color: var(--bg-darker); margin: 0; font-weight: 800; font-size: 18px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.5); letter-spacing: 0.5px;">
                <i class="fas fa-calendar-check me-2"></i>All Bookings <span style="background: rgba(0, 0, 0, 0.2); padding: 4px 12px; border-radius: 20px; font-size: 14px; margin-left: 8px;">({{ page_obj.paginator.count }} total)</span>
            </h5>
            <div style="color: var(--bg-darker); opacity: 0.85; font-size: 14px; font-weight: 600;">
                <i class="fas fa-list me-2"></i>Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ page_obj.paginator.count }}
            </div>
        </div>
    </div>
    
    <!-- Horizontal Scroll Wrapper with Custom Scrollbar -->
    <style>
        /* Custom Scrollbar Styling */
        .bookings-scroll-wrapper::-webkit-scrollbar {
            height: 14px;
        }
        .bookings-scroll-wrapper::-webkit-scrollbar-track {
            background: rgba(10, 14, 39, 0.8);
            border-radius: 10px;
            margin: 0 20px;
            border: 1px solid rgba(0, 217, 255, 0.2);
        }
        .bookings-scroll-wrapper::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-blue));
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.6);
            border: 2px solid rgba(0, 217, 255, 0.3);
        }
        .bookings-scroll-wrapper::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.8);
        }
        
        /* Booking Table Styling */
        .booking-table-row {
            border-bottom: 2px solid rgba(0, 217, 255, 0.12);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(26, 31, 58, 0.35);
        }
        .booking-table-row:hover {
            background: rgba(0, 217, 255, 0.1);
            transform: translateX(4px);
            box-shadow: -4px 0 0 0 var(--neon-cyan), 0 4px 20px rgba(0, 217, 255, 0.2);
        }
    </style>
    
    <div class="bookings-scroll-wrapper" style="overflow-x: auto; overflow-y: visible; scrollbar-width: thin; scrollbar-color: var(--neon-cyan) rgba(10, 14, 39, 0.8); padding: 0 0 15px 0;">
        <table style="margin: 0; width: 100%; min-width: 900px; table-layout: fixed; border-collapse: separate; border-spacing: 0;">
            <thead style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.25), rgba(0, 150, 255, 0.15)); border-bottom: 3px solid var(--neon-cyan); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 20px rgba(0, 217, 255, 0.3);">
                <tr>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; width: 140px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-user me-1" style="font-size: 12px;"></i>Client
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; width: 140px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-camera me-1" style="font-size: 12px;"></i>Photographer
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; width: 100px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-briefcase me-1"></i>Service
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; text-align: center; width: 100px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-calendar-day me-1"></i>Date & Time
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; width: 90px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-map-marker-alt me-1"></i>Location
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; text-align: center; width: 70px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-tasks me-1"></i>Status
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; text-align: center; width: 70px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-money-bill-wave me-1"></i>Payment
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; text-align: center; width: 100px; border-right: 1px solid rgba(0, 217, 255, 0.15);">
                        <i class="fas fa-dollar-sign me-1"></i>Amount
                    </th>
                    <th style="padding: 16px 20px; color: var(--neon-cyan); font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.7); text-transform: uppercase; letter-spacing: 1.2px; font-size: 11px; text-align: center; width: 130px;">
                        <i class="fas fa-cog me-1"></i>Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for booking in page_obj %}
                    <tr class="booking-table-row">
                        <!-- Client Column -->
                        <td style="padding: 14px 20px; width: 140px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            <div style="color: var(--neon-cyan); font-weight: 700; font-size: 14px; text-shadow: 0 0 8px rgba(0, 217, 255, 0.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{% if booking.client %}{{ booking.client.get_full_name|default:booking.client.email }}{% else %}{{ booking.client_name|default:booking.client_email }}{% endif %}">
                                {% if booking.client %}
                                    {{ booking.client.get_full_name|default:booking.client.email }}
                                {% else %}
                                    {{ booking.client_name|default:booking.client_email }}
                                {% endif %}
                            </div>
                        </td>
                        
                        <!-- Photographer Column -->
                        <td style="padding: 14px 20px; width: 140px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            <div style="color: rgba(224, 231, 255, 0.85); font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{ booking.photographer.get_full_name|default:booking.photographer.email }}">
                                {{ booking.photographer.get_full_name|default:booking.photographer.email }}
                            </div>
                        </td>
                        
                        <!-- Service Column -->
                        <td style="padding: 14px 20px; width: 100px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            <span style="background: rgba(217, 70, 239, 0.22); color: var(--neon-purple); padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid var(--neon-purple); box-shadow: 0 0 12px rgba(217, 70, 239, 0.35); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase; letter-spacing: 0.5px;">
                                {{ booking.service_type }}
                            </span>
                        </td>
                        
                        <!-- Date & Time Column -->
                        <td style="padding: 14px 20px; text-align: center; width: 100px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            <div style="color: rgba(224, 231, 255, 0.8); font-size: 13px; font-weight: 600; white-space: nowrap; margin-bottom: 3px;">
                                {{ booking.date|date:"M d, Y" }}
                            </div>
                            <div style="color: rgba(224, 231, 255, 0.5); font-size: 11px; white-space: nowrap; font-weight: 500;">
                                <i class="fas fa-clock" style="font-size: 9px; margin-right: 4px;"></i>{{ booking.time }}
                            </div>
                        </td>
                        
                        <!-- Location Column -->
                        <td style="padding: 14px 20px; width: 90px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            <div style="color: rgba(224, 231, 255, 0.65); font-size: 12px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{ booking.location }}">
                                <i class="fas fa-map-pin" style="font-size: 10px; margin-right: 5px; color: var(--neon-cyan); opacity: 0.7;"></i>{{ booking.location|truncatechars:25 }}
                            </div>
                        </td>
                        
                        <!-- Status Column -->
                        <td style="padding: 14px 20px; text-align: center; width: 70px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            {% if booking.status == 'pending' %}
                                <span style="background: rgba(255, 215, 0, 0.25); color: #FFD700; padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid #FFD700; box-shadow: 0 0 12px rgba(255, 215, 0, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-clock" style="font-size: 10px; margin-right: 4px;"></i>Pending
                                </span>
                            {% elif booking.status == 'confirmed' %}
                                <span style="background: rgba(0, 217, 255, 0.25); color: var(--neon-cyan); padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid var(--neon-cyan); box-shadow: 0 0 12px rgba(0, 217, 255, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-check-circle" style="font-size: 10px; margin-right: 4px;"></i>Confirmed
                                </span>
                            {% elif booking.status == 'completed' %}
                                <span style="background: rgba(57, 255, 20, 0.25); color: var(--neon-green); padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid var(--neon-green); box-shadow: 0 0 12px rgba(57, 255, 20, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-check-double" style="font-size: 10px; margin-right: 4px;"></i>Completed
                                </span>
                            {% elif booking.status == 'cancelled' %}
                                <span style="background: rgba(239, 68, 68, 0.25); color: #EF4444; padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid #EF4444; box-shadow: 0 0 12px rgba(239, 68, 68, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-times-circle" style="font-size: 10px; margin-right: 4px;"></i>Cancelled
                                </span>
                            {% else %}
                                <span style="background: rgba(150, 150, 150, 0.25); color: #AAA; padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid #888; box-shadow: 0 0 12px rgba(150, 150, 150, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    {{ booking.get_status_display }}
                                </span>
                            {% endif %}
                        </td>
                        
                        <!-- Payment Column -->
                        <td style="padding: 14px 20px; text-align: center; width: 70px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            {% if booking.payment_status == 'pending' %}
                                <span style="background: rgba(255, 215, 0, 0.25); color: #FFD700; padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid #FFD700; box-shadow: 0 0 12px rgba(255, 215, 0, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-hourglass-half" style="font-size: 10px; margin-right: 4px;"></i>Pending
                                </span>
                            {% elif booking.payment_status == 'paid' %}
                                <span style="background: rgba(57, 255, 20, 0.25); color: var(--neon-green); padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid var(--neon-green); box-shadow: 0 0 12px rgba(57, 255, 20, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-check-circle" style="font-size: 10px; margin-right: 4px;"></i>Paid
                                </span>
                            {% elif booking.payment_status == 'failed' %}
                                <span style="background: rgba(239, 68, 68, 0.25); color: #EF4444; padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid #EF4444; box-shadow: 0 0 12px rgba(239, 68, 68, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-exclamation-triangle" style="font-size: 10px; margin-right: 4px;"></i>Failed
                                </span>
                            {% elif booking.payment_status == 'refunded' %}
                                <span style="background: rgba(150, 150, 200, 0.25); color: #9999DD; padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid #8888CC; box-shadow: 0 0 12px rgba(150, 150, 200, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    <i class="fas fa-undo" style="font-size: 10px; margin-right: 4px;"></i>Refunded
                                </span>
                            {% else %}
                                <span style="background: rgba(150, 150, 150, 0.25); color: #AAA; padding: 6px 12px; border-radius: 7px; font-weight: 700; border: 2px solid #888; box-shadow: 0 0 12px rgba(150, 150, 150, 0.4); font-size: 11px; display: inline-block; white-space: nowrap; text-transform: uppercase;">
                                    {{ booking.get_payment_status_display }}
                                </span>
                            {% endif %}
                        </td>
                        
                        <!-- Amount Column -->
                        <td style="padding: 14px 20px; text-align: center; width: 100px; border-right: 1px solid rgba(0, 217, 255, 0.08);">
                            {% load static %}
                            {% with transaction=booking.transactions.first %}
                                {% if transaction %}
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
                                        <div style="color: var(--neon-cyan); font-weight: 800; font-size: 15px; text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);">
                                            {{ transaction.amount|floatformat:0 }} RWF
                                        </div>
                                        {% if transaction.payment_method %}
                                            <div style="font-size: 10px; color: rgba(224, 231, 255, 0.5); text-transform: capitalize;">
                                                {% if transaction.payment_method == 'stripe' %}
                                                    üí≥ Card
                                                    {% if transaction.card_last_four %}
                                                        (****{{ transaction.card_last_four }})
                                                    {% endif %}
                                                {% elif transaction.payment_method == 'mobile_money' %}
                                                    üì± {{ transaction.mobile_money_provider|upper|default:"MoMo" }}
                                                {% elif transaction.payment_method == 'paypal' %}
                                                    üÖøÔ∏è PayPal
                                                {% elif transaction.payment_method == 'bank_transfer' %}
                                                    üè¶ Bank
                                                {% else %}
                                                    {{ transaction.payment_method }}
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                {% elif booking.photographer.price %}
                                    <div style="color: rgba(224, 231, 255, 0.4); font-weight: 600; font-size: 14px;">
                                        {{ booking.photographer.price|floatformat:0 }} RWF
                                        <div style="font-size: 10px; color: rgba(224, 231, 255, 0.3); margin-top: 2px;">
                                            (Not paid)
                                        </div>
                                    </div>
                                {% else %}
                                    <span style="color: rgba(224, 231, 255, 0.3); font-size: 12px;">‚Äî</span>
                                {% endif %}
                            {% endwith %}
                        </td>
                        
                        <!-- Actions Column -->
                        <td style="padding: 14px 20px; text-align: center; width: 130px;">
                            <button type="button" onclick="showBookingDetails({{ booking.id }})"
                               style="background: rgba(0, 217, 255, 0.22); color: var(--neon-cyan); border: 2px solid var(--neon-cyan); padding: 7px 16px; border-radius: 7px; font-weight: 700; box-shadow: 0 0 12px rgba(0, 217, 255, 0.35); transition: all 0.25s ease; display: inline-flex; align-items: center; gap: 6px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer;"
                               title="View Complete Booking Details"
                               onmouseover="this.style.background='rgba(0, 217, 255, 0.35)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 0 20px rgba(0, 217, 255, 0.6)';"
                               onmouseout="this.style.background='rgba(0, 217, 255, 0.22)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 0 12px rgba(0, 217, 255, 0.35)';">
                                <i class="fas fa-info-circle" style="font-size: 11px;"></i>Full View
                            </button>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 70px 20px; background: rgba(26, 31, 58, 0.3);">
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 22px;">
                                <div style="width: 100px; height: 100px; border-radius: 50%; background: rgba(0, 217, 255, 0.08); display: flex; align-items: center; justify-content: center; border: 3px dashed rgba(0, 217, 255, 0.3); box-shadow: 0 0 30px rgba(0, 217, 255, 0.2);">
                                    <i class="fas fa-calendar-times" style="font-size: 48px; color: rgba(0, 217, 255, 0.4); text-shadow: 0 0 20px rgba(0, 217, 255, 0.5);"></i>
                                </div>
                                <div style="color: var(--neon-cyan); font-size: 24px; font-weight: 800; text-shadow: 0 0 15px rgba(0, 217, 255, 0.6); letter-spacing: 1.5px; text-transform: uppercase;">
                                    No Bookings Found
                                </div>
                                <div style="color: rgba(224, 231, 255, 0.6); font-size: 14px; max-width: 450px; line-height: 1.6; font-weight: 500;">
                                    No bookings match your current search criteria. Try adjusting your filters or clearing the search to view all bookings.
                                </div>
                                <button onclick="window.location.href='{% url 'admin_dashboard:bookings_management' %}';" 
                                        style="background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue)); color: var(--bg-darker); border: none; padding: 12px 28px; border-radius: 8px; font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 0.8px; box-shadow: 0 0 20px rgba(0, 217, 255, 0.4); cursor: pointer; transition: all 0.3s ease; margin-top: 10px;"
                                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 0 30px rgba(0, 217, 255, 0.6)';"
                                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 0 20px rgba(0, 217, 255, 0.4)';">
                                    <i class="fas fa-redo me-2"></i>Clear Filters
                                </button>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
{% if page_obj.has_other_pages %}
    <nav aria-label="Bookings pagination" class="mt-4">
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if payment_filter %}&payment={{ payment_filter }}{% endif %}">First</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if payment_filter %}&payment={{ payment_filter }}{% endif %}">Previous</a>
                </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <li class="page-item active">
                        <span class="page-link">{{ num }}</span>
                    </li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if payment_filter %}&payment={{ payment_filter }}{% endif %}">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if payment_filter %}&payment={{ payment_filter }}{% endif %}">Next</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if payment_filter %}&payment={{ payment_filter }}{% endif %}">Last</a>
                </li>
            {% endif %}
        </ul>
    </nav>
{% endif %}

<!-- Booking Details Modal -->
<div id="bookingDetailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); z-index: 10000; overflow-y: auto; padding: 30px;">
    <div style="max-width: 1200px; margin: 0 auto; background: linear-gradient(135deg, rgba(26, 31, 58, 0.98) 0%, rgba(10, 14, 39, 0.98) 100%); border-radius: 20px; box-shadow: 0 0 60px rgba(0, 217, 255, 0.4), inset 0 0 30px rgba(0, 217, 255, 0.1); border: 2px solid var(--neon-cyan); position: relative;">
        
        <!-- Modal Header -->
        <div style="background: linear-gradient(135deg, var(--neon-blue) 0%, var(--neon-cyan) 100%); padding: 25px 35px; border-radius: 20px 20px 0 0; border-bottom: 4px solid var(--neon-cyan); display: flex; justify-content: space-between; align-items: center;">
            <h3 style="color: var(--bg-darker); margin: 0; font-weight: 900; font-size: 24px; text-shadow: 0 0 15px rgba(255, 255, 255, 0.6); letter-spacing: 1px;">
                <i class="fas fa-calendar-check me-2"></i>Complete Booking Information
            </h3>
            <button onclick="closeBookingDetails()" style="background: rgba(0, 0, 0, 0.3); border: none; color: var(--bg-darker); width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; transition: all 0.3s ease; font-weight: 900;"
                    onmouseover="this.style.background='rgba(0, 0, 0, 0.5)'; this.style.transform='rotate(90deg)';"
                    onmouseout="this.style.background='rgba(0, 0, 0, 0.3)'; this.style.transform='rotate(0)';">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Modal Body -->
        <div id="bookingDetailsContent" style="padding: 35px;">
            <div style="text-align: center; padding: 60px; color: rgba(224, 231, 255, 0.6);">
                <i class="fas fa-spinner fa-spin" style="font-size: 48px; color: var(--neon-cyan);"></i>
                <p style="margin-top: 20px; font-size: 16px; font-weight: 600;">Loading booking details...</p>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    function showBookingDetails(bookingId) {
        const modal = document.getElementById('bookingDetailsModal');
        const content = document.getElementById('bookingDetailsContent');
        
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        fetch(`/admin-dashboard/bookings/${bookingId}/details/`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const booking = data.booking;
                    content.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px;">
                            
                            <!-- Booking Overview Card -->
                            <div style="background: rgba(0, 217, 255, 0.08); border-radius: 16px; padding: 25px; border: 2px solid rgba(0, 217, 255, 0.25); box-shadow: 0 0 25px rgba(0, 217, 255, 0.15);">
                                <h4 style="color: var(--neon-cyan); font-weight: 800; font-size: 18px; margin-bottom: 20px; text-shadow: 0 0 12px rgba(0, 217, 255, 0.5); border-bottom: 2px solid rgba(0, 217, 255, 0.3); padding-bottom: 12px;">
                                    <i class="fas fa-info-circle me-2"></i>Booking Overview
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-hashtag me-2"></i>Booking ID:</span>
                                        <span class="info-value">#${booking.id}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-briefcase me-2"></i>Service Type:</span>
                                        <span class="info-value">${booking.service_type_display}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-calendar me-2"></i>Date:</span>
                                        <span class="info-value" style="color: var(--neon-cyan); font-weight: 700;">${booking.date}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-clock me-2"></i>Time:</span>
                                        <span class="info-value">${booking.time}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-map-marker-alt me-2"></i>Location:</span>
                                        <span class="info-value">${booking.location}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-calendar-plus me-2"></i>Created:</span>
                                        <span class="info-value">${booking.created_at}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status Information Card -->
                            <div style="background: rgba(0, 217, 255, 0.08); border-radius: 16px; padding: 25px; border: 2px solid rgba(0, 217, 255, 0.25); box-shadow: 0 0 25px rgba(0, 217, 255, 0.15);">
                                <h4 style="color: var(--neon-cyan); font-weight: 800; font-size: 18px; margin-bottom: 20px; text-shadow: 0 0 12px rgba(0, 217, 255, 0.5); border-bottom: 2px solid rgba(0, 217, 255, 0.3); padding-bottom: 12px;">
                                    <i class="fas fa-tasks me-2"></i>Status Information
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-flag me-2"></i>Booking Status:</span>
                                        <span class="info-value">
                                            <span style="background: rgba(0, 217, 255, 0.2); color: var(--neon-cyan); padding: 5px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; border: 1px solid var(--neon-cyan);">
                                                ${booking.status_display}
                                            </span>
                                        </span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-money-bill-wave me-2"></i>Payment Status:</span>
                                        <span class="info-value">
                                            <span style="background: rgba(57, 255, 20, 0.2); color: var(--neon-green); padding: 5px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; border: 1px solid var(--neon-green);">
                                                ${booking.payment_status_display}
                                            </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Client Information Card -->
                            <div style="background: rgba(217, 70, 239, 0.08); border-radius: 16px; padding: 25px; border: 2px solid rgba(217, 70, 239, 0.25); box-shadow: 0 0 25px rgba(217, 70, 239, 0.15);">
                                <h4 style="color: var(--neon-purple); font-weight: 800; font-size: 18px; margin-bottom: 20px; text-shadow: 0 0 12px rgba(217, 70, 239, 0.5); border-bottom: 2px solid rgba(217, 70, 239, 0.3); padding-bottom: 12px;">
                                    <i class="fas fa-user me-2"></i>Client Information
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    ${booking.client_id ? `
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                        <img src="${booking.client_avatar}" alt="Client" 
                                             style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--neon-purple); box-shadow: 0 0 15px rgba(217, 70, 239, 0.4); object-fit: cover;">
                                        <div>
                                            <div style="color: var(--neon-purple); font-weight: 700; font-size: 16px; margin-bottom: 3px;">${booking.client_name}</div>
                                            <div style="color: rgba(224, 231, 255, 0.6); font-size: 12px;">${booking.client_email}</div>
                                        </div>
                                    </div>
                                    ` : ''}
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-user me-2"></i>Name:</span>
                                        <span class="info-value">${booking.client_name}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-envelope me-2"></i>Email:</span>
                                        <span class="info-value">${booking.client_email}</span>
                                    </div>
                                    ${booking.client_phone ? `
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-phone me-2"></i>Phone:</span>
                                        <span class="info-value">${booking.client_phone}</span>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <!-- Photographer Information Card -->
                            <div style="background: rgba(57, 255, 20, 0.08); border-radius: 16px; padding: 25px; border: 2px solid rgba(57, 255, 20, 0.25); box-shadow: 0 0 25px rgba(57, 255, 20, 0.15);">
                                <h4 style="color: var(--neon-green); font-weight: 800; font-size: 18px; margin-bottom: 20px; text-shadow: 0 0 12px rgba(57, 255, 20, 0.5); border-bottom: 2px solid rgba(57, 255, 20, 0.3); padding-bottom: 12px;">
                                    <i class="fas fa-camera me-2"></i>Photographer Information
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                        <img src="${booking.photographer_avatar}" alt="Photographer" 
                                             style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--neon-green); box-shadow: 0 0 15px rgba(57, 255, 20, 0.4); object-fit: cover;">
                                        <div>
                                            <div style="color: var(--neon-green); font-weight: 700; font-size: 16px; margin-bottom: 3px;">${booking.photographer_name}</div>
                                            <div style="color: rgba(224, 231, 255, 0.6); font-size: 12px;">${booking.photographer_email}</div>
                                        </div>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-user me-2"></i>Name:</span>
                                        <span class="info-value">${booking.photographer_name}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-envelope me-2"></i>Email:</span>
                                        <span class="info-value">${booking.photographer_email}</span>
                                    </div>
                                    ${booking.photographer_phone ? `
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-phone me-2"></i>Phone:</span>
                                        <span class="info-value">${booking.photographer_phone}</span>
                                    </div>
                                    ` : ''}
                                    ${booking.photographer_price ? `
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-dollar-sign me-2"></i>Base Price:</span>
                                        <span class="info-value" style="color: var(--neon-green); font-weight: 700;">Rwf ${booking.photographer_price}</span>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <!-- Payment Information Card -->
                            ${booking.payment ? `
                            <div style="background: rgba(168, 85, 247, 0.08); border-radius: 16px; padding: 25px; border: 2px solid rgba(168, 85, 247, 0.25); box-shadow: 0 0 25px rgba(168, 85, 247, 0.15); margin-top: 20px;">
                                <h4 style="color: #A855F7; font-weight: 800; font-size: 18px; margin-bottom: 20px; text-shadow: 0 0 12px rgba(168, 85, 247, 0.5); border-bottom: 2px solid rgba(168, 85, 247, 0.3); padding-bottom: 12px;">
                                    <i class="fas fa-credit-card me-2"></i>Payment Information
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 15px;">
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-money-bill-wave me-2"></i>Amount:</span>
                                        <span class="info-value" style="color: #A855F7; font-weight: 700; font-size: 18px;">Rwf ${booking.payment.amount.toLocaleString()}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-wallet me-2"></i>Payment Method:</span>
                                        <span class="info-value">
                                            ${booking.payment.payment_method === 'card' ? '<i class="fas fa-credit-card me-2" style="color: #4CAF50;"></i>' : ''}
                                            ${booking.payment.payment_method === 'mobile_money' ? '<i class="fas fa-mobile-alt me-2" style="color: #FF9800;"></i>' : ''}
                                            ${booking.payment.payment_method === 'paypal' ? '<i class="fab fa-paypal me-2" style="color: #0070BA;"></i>' : ''}
                                            ${booking.payment.payment_method === 'bank_transfer' ? '<i class="fas fa-university me-2" style="color: #2196F3;"></i>' : ''}
                                            ${booking.payment.payment_method_display}
                                        </span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-info-circle me-2"></i>Status:</span>
                                        <span class="info-value">
                                            <span style="
                                                padding: 6px 12px;
                                                border-radius: 20px;
                                                font-size: 12px;
                                                font-weight: 700;
                                                text-transform: uppercase;
                                                letter-spacing: 0.5px;
                                                background: ${booking.payment.status === 'completed' ? 'rgba(34, 197, 94, 0.2)' : booking.payment.status === 'pending' ? 'rgba(251, 146, 60, 0.2)' : 'rgba(239, 68, 68, 0.2)'};
                                                color: ${booking.payment.status === 'completed' ? '#22C55E' : booking.payment.status === 'pending' ? '#FB923C' : '#EF4444'};
                                                border: 1px solid ${booking.payment.status === 'completed' ? 'rgba(34, 197, 94, 0.4)' : booking.payment.status === 'pending' ? 'rgba(251, 146, 60, 0.4)' : 'rgba(239, 68, 68, 0.4)'};
                                            ">
                                                ${booking.payment.status_display}
                                            </span>
                                        </span>
                                    </div>
                                    ${booking.payment.transaction_id ? `
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-hashtag me-2"></i>Transaction ID:</span>
                                        <span class="info-value" style="font-family: monospace; font-size: 12px;">${booking.payment.transaction_id}</span>
                                    </div>
                                    ` : ''}
                                    
                                    ${booking.payment.card_brand && booking.payment.card_last_four ? `
                                    <div class="info-row" style="background: rgba(76, 175, 80, 0.1); border-left-color: #4CAF50;">
                                        <span class="info-label"><i class="fas fa-credit-card me-2"></i>Card Details:</span>
                                        <span class="info-value">${booking.payment.card_brand} ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ${booking.payment.card_last_four}</span>
                                    </div>
                                    ${booking.payment.cardholder_name ? `
                                    <div class="info-row" style="background: rgba(76, 175, 80, 0.1); border-left-color: #4CAF50;">
                                        <span class="info-label"><i class="fas fa-user me-2"></i>Cardholder:</span>
                                        <span class="info-value">${booking.payment.cardholder_name}</span>
                                    </div>
                                    ` : ''}
                                    ` : ''}
                                    
                                    ${booking.payment.mobile_money_provider && booking.payment.mobile_money_phone ? `
                                    <div class="info-row" style="background: rgba(255, 152, 0, 0.1); border-left-color: #FF9800;">
                                        <span class="info-label"><i class="fas fa-mobile-alt me-2"></i>Mobile Money:</span>
                                        <span class="info-value">${booking.payment.mobile_money_provider}</span>
                                    </div>
                                    <div class="info-row" style="background: rgba(255, 152, 0, 0.1); border-left-color: #FF9800;">
                                        <span class="info-label"><i class="fas fa-phone me-2"></i>Phone Number:</span>
                                        <span class="info-value">${booking.payment.mobile_money_phone}</span>
                                    </div>
                                    ` : ''}
                                    
                                    ${booking.payment.paypal_email ? `
                                    <div class="info-row" style="background: rgba(0, 112, 186, 0.1); border-left-color: #0070BA;">
                                        <span class="info-label"><i class="fab fa-paypal me-2"></i>PayPal Email:</span>
                                        <span class="info-value">${booking.payment.paypal_email}</span>
                                    </div>
                                    ` : ''}
                                    
                                    ${booking.payment.bank_name || booking.payment.bank_reference ? `
                                    ${booking.payment.bank_name ? `
                                    <div class="info-row" style="background: rgba(33, 150, 243, 0.1); border-left-color: #2196F3;">
                                        <span class="info-label"><i class="fas fa-university me-2"></i>Bank Name:</span>
                                        <span class="info-value">${booking.payment.bank_name}</span>
                                    </div>
                                    ` : ''}
                                    ${booking.payment.bank_reference ? `
                                    <div class="info-row" style="background: rgba(33, 150, 243, 0.1); border-left-color: #2196F3;">
                                        <span class="info-label"><i class="fas fa-receipt me-2"></i>Reference:</span>
                                        <span class="info-value" style="font-family: monospace; font-size: 12px;">${booking.payment.bank_reference}</span>
                                    </div>
                                    ` : ''}
                                    ` : ''}
                                    
                                    <div class="info-row">
                                        <span class="info-label"><i class="fas fa-clock me-2"></i>Payment Date:</span>
                                        <span class="info-value">${booking.payment.created_at}</span>
                                    </div>
                                </div>
                            </div>
                            ` : `
                            <div style="background: ${booking.payment_status === 'paid' ? 'rgba(251, 146, 60, 0.08)' : 'rgba(239, 68, 68, 0.08)'}; border-radius: 16px; padding: 25px; border: 2px solid ${booking.payment_status === 'paid' ? 'rgba(251, 146, 60, 0.25)' : 'rgba(239, 68, 68, 0.25)'}; box-shadow: 0 0 25px ${booking.payment_status === 'paid' ? 'rgba(251, 146, 60, 0.15)' : 'rgba(239, 68, 68, 0.15)'}; margin-top: 20px; text-align: center;">
                                <i class="fas fa-info-circle" style="font-size: 48px; color: ${booking.payment_status === 'paid' ? '#FB923C' : '#EF4444'}; margin-bottom: 15px;"></i>
                                <h4 style="color: ${booking.payment_status === 'paid' ? '#FB923C' : '#EF4444'}; font-weight: 700; font-size: 16px; margin-bottom: 10px;">No Transaction Details Available</h4>
                                ${booking.expected_amount ? `
                                <div style="margin: 20px 0;">
                                    <div style="color: rgba(224, 231, 255, 0.6); font-size: 13px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">Expected Amount</div>
                                    <div style="color: #A855F7; font-weight: 700; font-size: 28px; text-shadow: 0 0 15px rgba(168, 85, 247, 0.4);">Rwf ${booking.expected_amount.toLocaleString()}</div>
                                </div>
                                ` : ''}
                                <p style="color: rgba(224, 231, 255, 0.6); font-size: 14px; margin-bottom: 12px;">
                                    ${booking.payment_status === 'paid' ? 
                                        'Booking status shows <strong style="color: #22C55E;">PAID</strong>, but detailed transaction information is not available.' : 
                                        'Payment has not been processed for this booking yet.'
                                    }
                                </p>
                                <div style="display: inline-block; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; background: ${booking.payment_status === 'paid' ? 'rgba(34, 197, 94, 0.2)' : 'rgba(239, 68, 68, 0.2)'}; color: ${booking.payment_status === 'paid' ? '#22C55E' : '#EF4444'}; border: 1px solid ${booking.payment_status === 'paid' ? 'rgba(34, 197, 94, 0.4)' : 'rgba(239, 68, 68, 0.4)'};">
                                    Booking Payment Status: ${booking.payment_status_display}
                                </div>
                                ${booking.payment_status === 'paid' ? `
                                <p style="color: rgba(224, 231, 255, 0.5); font-size: 12px; margin-top: 15px; font-style: italic;">
                                    <i class="fas fa-lightbulb me-1"></i>This booking was marked as paid before the payment tracking system was implemented.
                                </p>
                                ` : ''}
                            </div>
                            `}
                            
                        </div>
                        
                        <style>
                            .info-row {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                padding: 12px 15px;
                                background: rgba(0, 0, 0, 0.25);
                                border-radius: 8px;
                                border-left: 3px solid rgba(0, 217, 255, 0.4);
                                transition: all 0.3s ease;
                            }
                            .info-row:hover {
                                background: rgba(0, 217, 255, 0.1);
                                border-left-color: var(--neon-cyan);
                                transform: translateX(3px);
                            }
                            .info-label {
                                color: rgba(224, 231, 255, 0.6);
                                font-size: 13px;
                                font-weight: 600;
                                text-transform: uppercase;
                                letter-spacing: 0.3px;
                            }
                            .info-value {
                                color: rgba(224, 231, 255, 0.95);
                                font-size: 14px;
                                font-weight: 600;
                                text-align: right;
                            }
                        </style>
                    `;
                } else {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 60px; color: #EF4444;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <p style="font-size: 16px; font-weight: 600;">Failed to load booking details</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                content.innerHTML = `
                    <div style="text-align: center; padding: 60px; color: #EF4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <p style="font-size: 16px; font-weight: 600;">Error loading booking details</p>
                    </div>
                `;
            });
    }
    
    function closeBookingDetails() {
        document.getElementById('bookingDetailsModal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    // Close modal when clicking outside
    document.getElementById('bookingDetailsModal')?.addEventListener('click', function(e) {
        if (e.target === this) {
            closeBookingDetails();
        }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && document.getElementById('bookingDetailsModal').style.display === 'block') {
            closeBookingDetails();
        }
    });
</script>
{% endblock %}
{% endblock %}