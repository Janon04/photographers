{% extends 'admin_dashboard/base_admin.html' %}
{% load humanize %}
{% load admin_extras %}

{% block title %}Subscription Plans Management{% endblock %}
{% block page_title %}Subscription Plans Management{% endblock %}

{% block content %}
<!-- Header Section -->
<div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(0, 217, 255, 0.1) 100%); border-radius: 20px; padding: 32px; margin-bottom: 32px; border: 2px solid rgba(168, 85, 247, 0.3); box-shadow: 0 10px 30px rgba(168, 85, 247, 0.2); position: relative; overflow: hidden;">
    <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(0, 217, 255, 0.2) 0%, transparent 70%); border-radius: 50%;"></div>
    <div style="display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1;">
        <div>
            <h2 style="color: #A855F7; font-weight: 900; font-size: 32px; margin-bottom: 10px; text-shadow: 0 0 20px rgba(168, 85, 247, 0.4);">
                <i class="fas fa-layer-group me-3" style="color: var(--neon-cyan);"></i>Subscription Plans
            </h2>
            <p style="color: rgba(224, 231, 255, 0.8); font-size: 16px; margin: 0;">
                Manage subscription plans, pricing, and features for your platform
            </p>
        </div>
        <div style="display: flex; gap: 12px;">
            <a href="{% url 'admin_dashboard:dashboard' %}" style="background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue)); color: var(--bg-darker); border: none; font-weight: 700; padding: 12px 24px; border-radius: 12px; text-decoration: none; display: inline-flex; align-items: center; box-shadow: 0 8px 20px rgba(0, 217, 255, 0.4); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 30px rgba(0, 217, 255, 0.6)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(0, 217, 255, 0.4)';">
                <i class="fas fa-arrow-left me-2"></i> Dashboard
            </a>
            <a href="{% url 'admin_dashboard:subscription_plan_add' %}" style="background: linear-gradient(135deg, #22C55E, #16A34A); color: white; border: none; font-weight: 700; padding: 12px 24px; border-radius: 12px; text-decoration: none; display: inline-flex; align-items: center; box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 30px rgba(34, 197, 94, 0.6)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(34, 197, 94, 0.4)';">
                <i class="fas fa-plus me-2"></i> Add New Plan
            </a>
        </div>
    </div>
</div>

<!-- Key Statistics Cards - Modern Responsive Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 32px;">
    <!-- Total Plans Card -->
    <div style="background: linear-gradient(135deg, rgba(251, 146, 60, 0.15), rgba(249, 115, 22, 0.1)); border: 2px solid rgba(251, 146, 60, 0.3); border-radius: 20px; padding: 28px; box-shadow: 0 10px 30px rgba(251, 146, 60, 0.2); position: relative; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(251, 146, 60, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(251, 146, 60, 0.2)';">
        <div style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: radial-gradient(circle, rgba(251, 146, 60, 0.2), transparent); border-radius: 50%;"></div>
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; position: relative; z-index: 1;">
            <h6 style="color: rgba(224, 231, 255, 0.8); font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">Total Plans</h6>
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #FB923C, #F97316); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(251, 146, 60, 0.4);">
                <i class="fas fa-layer-group" style="font-size: 20px; color: white;"></i>
            </div>
        </div>
        <div style="position: relative; z-index: 1;">
            <div style="font-size: 42px; font-weight: 900; color: #FB923C; margin-bottom: 8px; text-shadow: 0 0 20px rgba(251, 146, 60, 0.3);">{{ total_plans }}</div>
            <p style="color: rgba(224, 231, 255, 0.6); font-size: 13px; margin: 0;">Active subscription plans</p>
        </div>
    </div>

    <!-- Total Subscribers Card -->
    <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.1)); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 20px; padding: 28px; box-shadow: 0 10px 30px rgba(34, 197, 94, 0.2); position: relative; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(34, 197, 94, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(34, 197, 94, 0.2)';">
        <div style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: radial-gradient(circle, rgba(34, 197, 94, 0.2), transparent); border-radius: 50%;"></div>
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; position: relative; z-index: 1;">
            <h6 style="color: rgba(224, 231, 255, 0.8); font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">Total Subscribers</h6>
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #22C55E, #16A34A); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);">
                <i class="fas fa-users" style="font-size: 20px; color: white;"></i>
            </div>
        </div>
        <div style="position: relative; z-index: 1;">
            <div style="font-size: 42px; font-weight: 900; color: #22C55E; margin-bottom: 8px; text-shadow: 0 0 20px rgba(34, 197, 94, 0.3);" id="total-subscribers">0</div>
            <p style="color: rgba(224, 231, 255, 0.6); font-size: 13px; margin: 0;">Active subscriptions</p>
        </div>
    </div>

    <!-- Monthly Revenue Card -->
    <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(147, 51, 234, 0.1)); border: 2px solid rgba(168, 85, 247, 0.3); border-radius: 20px; padding: 28px; box-shadow: 0 10px 30px rgba(168, 85, 247, 0.2); position: relative; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(168, 85, 247, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(168, 85, 247, 0.2)';">
        <div style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; background: radial-gradient(circle, rgba(168, 85, 247, 0.2), transparent); border-radius: 50%;"></div>
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; position: relative; z-index: 1;">
            <h6 style="color: rgba(224, 231, 255, 0.8); font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin: 0;">Monthly Revenue</h6>
            <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #A855F7, #9333EA); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(168, 85, 247, 0.4);">
                <i class="fas fa-coins" style="font-size: 20px; color: white;"></i>
            </div>
        </div>
        <div style="position: relative; z-index: 1;">
            <div style="font-size: 42px; font-weight: 900; color: #A855F7; margin-bottom: 8px; text-shadow: 0 0 20px rgba(168, 85, 247, 0.3);" id="total-monthly-revenue">0 RWF</div>
            <p style="color: rgba(224, 231, 255, 0.6); font-size: 13px; margin: 0;">From all subscriptions</p>
        </div>
    </div>
</div>

<!-- Subscription Plans Data Table -->
<div style="background: linear-gradient(135deg, rgba(26, 31, 58, 0.95) 0%, rgba(10, 14, 39, 0.98) 100%); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0, 217, 255, 0.3); border: 2px solid rgba(0, 217, 255, 0.2); margin-bottom: 32px;">
    <div style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.15), rgba(168, 85, 247, 0.15)); padding: 24px; border-bottom: 2px solid rgba(0, 217, 255, 0.3); display: flex; justify-content: space-between; align-items: center;">
        <h5 style="color: var(--neon-cyan); font-weight: 800; font-size: 20px; margin: 0; text-shadow: 0 0 15px rgba(0, 217, 255, 0.6);">
            <i class="fas fa-layer-group me-2"></i>Subscription Plans
            <span style="color: #A855F7; font-size: 18px;">({{ total_plans }} total)</span>
        </h5>
        <a href="{% url 'admin_dashboard:subscription_plan_add' %}" style="background: linear-gradient(135deg, #22C55E, #16A34A); color: white; border: none; font-weight: 700; padding: 10px 20px; border-radius: 10px; text-decoration: none; box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(34, 197, 94, 0.6)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(34, 197, 94, 0.4)';">
            <i class="fas fa-plus me-2"></i> Add Plan
        </a>
    </div>
    
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead style="background: rgba(0, 217, 255, 0.1); border-bottom: 2px solid rgba(0, 217, 255, 0.3);">
                <tr>
                    <th style="width: 20%; border: none; padding: 18px 20px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px;">Plan Details</th>
                    <th style="width: 15%; border: none; padding: 18px 20px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px;">Pricing</th>
                    <th style="width: 15%; border: none; padding: 18px 20px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px;">Subscribers</th>
                    <th style="width: 20%; border: none; padding: 18px 20px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px;">Features</th>
                    <th style="width: 15%; border: none; padding: 18px 20px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px;">Revenue</th>
                    <th style="width: 15%; border: none; padding: 18px 20px; font-weight: 700; color: var(--neon-cyan); text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for plan in plans %}
                <tr style="border-bottom: 1px solid rgba(0, 217, 255, 0.1); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 217, 255, 0.05)';" onmouseout="this.style.background='transparent';">
                    <td style="padding: 20px; border: none;">
                        <div class="d-flex align-items-center">
                            <div style="width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 16px; box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
                                {% if plan.name == 'basic' %}background: linear-gradient(135deg, #64748B, #475569); color: white;
                                {% elif plan.name == 'standard' %}background: linear-gradient(135deg, #FB923C, #F97316); color: white;
                                {% else %}background: linear-gradient(135deg, #A855F7, #9333EA); color: white;{% endif %}">
                                {% if plan.name == 'basic' %}<i class="fas fa-star"></i>
                                {% elif plan.name == 'standard' %}<i class="fas fa-medal"></i>
                                {% else %}<i class="fas fa-crown"></i>{% endif %}
                            </div>
                            <div>
                                <h6 style="color: rgba(224, 231, 255, 0.95); font-weight: 800; font-size: 16px; margin-bottom: 4px;">{{ plan.display_name }}</h6>
                                <small style="color: rgba(224, 231, 255, 0.5); font-size: 12px;">{{ plan.name|title }} Plan</small>
                                {% if not plan.is_active %}
                                <span style="background: rgba(239, 68, 68, 0.2); color: #EF4444; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; margin-left: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">Inactive</span>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td style="padding: 20px; border: none;">
                        <div>
                            <div style="font-size: 20px; font-weight: 900; color: #FB923C; text-shadow: 0 0 10px rgba(251, 146, 60, 0.3);">
                                {{ plan.price_monthly|floatformat:0 }} RWF
                            </div>
                            <small style="color: rgba(224, 231, 255, 0.5); font-size: 11px;">/month</small>
                            {% if plan.price_yearly %}
                            <div style="margin-top: 6px;">
                                <small style="color: rgba(224, 231, 255, 0.6); font-size: 12px;">
                                    {{ plan.price_yearly|floatformat:0 }} RWF/year
                                </small>
                            </div>
                            {% endif %}
                        </div>
                    </td>
                    <td style="padding: 20px; border: none;">
                        <div class="row g-2">
                            <div class="col-6">
                                <div class="text-center p-2" style="background: rgba(168, 85, 247, 0.15); border-radius: 10px; border: 1px solid rgba(168, 85, 247, 0.3);">
                                    <div style="font-size: 18px; font-weight: 900; color: #A855F7;" class="plan-total-subs" data-plan-id="{{ plan.id }}">
                                        {% with plan_data=plan_stats|get_item:plan.id %}
                                            {{ plan_data.total_subscribers|default:0 }}
                                        {% endwith %}
                                    </div>
                                    <small style="color: rgba(224, 231, 255, 0.6); font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px;">Total</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center p-2" style="background: rgba(34, 197, 94, 0.15); border-radius: 10px; border: 1px solid rgba(34, 197, 94, 0.3);">
                                    <div style="font-size: 18px; font-weight: 900; color: #22C55E;" class="plan-active-subs" data-plan-id="{{ plan.id }}">
                                        {% with plan_data=plan_stats|get_item:plan.id %}
                                            {{ plan_data.active_subscribers|default:0 }}
                                        {% endwith %}
                                    </div>
                                    <small style="color: rgba(224, 231, 255, 0.6); font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px;">Active</small>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td style="padding: 20px; border: none;">
                        <ul style="list-style: none; padding: 0; margin: 0; font-size: 13px;">
                            <li style="padding: 6px 0; color: rgba(224, 231, 255, 0.85); display: flex; align-items: center;">
                                <i class="fas fa-camera me-2" style="color: var(--neon-cyan); font-size: 12px;"></i>
                                {% if plan.max_photos_upload == -1 %}∞{% else %}{{ plan.max_photos_upload }}{% endif %} photos/mo
                            </li>
                            <li style="padding: 6px 0; color: rgba(224, 231, 255, 0.85); display: flex; align-items: center;">
                                <i class="fas fa-hdd me-2" style="color: var(--neon-cyan); font-size: 12px;"></i>
                                {% if plan.max_storage_gb == -1 %}∞{% else %}{{ plan.max_storage_gb }}GB{% endif %} storage
                            </li>
                            <li style="padding: 6px 0; color: rgba(224, 231, 255, 0.85); display: flex; align-items: center;">
                                <i class="fas fa-percent me-2" style="color: var(--neon-cyan); font-size: 12px;"></i>
                                {{ plan.commission_rate }}% commission
                            </li>
                        </ul>
                    </td>
                    <td style="padding: 20px; border: none;">
                        <div class="text-center p-3" style="background: rgba(0, 217, 255, 0.1); border-radius: 12px; border: 1px solid rgba(0, 217, 255, 0.3);">
                            <div style="font-size: 20px; font-weight: 900; color: var(--neon-cyan); text-shadow: 0 0 10px rgba(0, 217, 255, 0.3);" class="plan-revenue" data-plan-id="{{ plan.id }}">
                                {% with plan_data=plan_stats|get_item:plan.id %}
                                    {{ plan_data.monthly_revenue|default:0|floatformat:0 }}
                                {% endwith %}
                            </div>
                            <small style="color: rgba(224, 231, 255, 0.5); font-size: 11px;">RWF/month</small>
                        </div>
                    </td>
                    <td style="padding: 20px; border: none;">
                        <div class="d-flex flex-column gap-2">
                            <a href="{% url 'admin_dashboard:subscription_plan_edit' plan.id %}" style="background: linear-gradient(135deg, #A855F7, #9333EA); color: white; border: none; font-weight: 700; padding: 8px 16px; border-radius: 8px; text-decoration: none; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3); transition: all 0.3s ease; text-align: center; font-size: 12px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(168, 85, 247, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(168, 85, 247, 0.3)';">
                                <i class="fas fa-edit me-1"></i> Edit
                            </a>
                            <a href="{% url 'admin_dashboard:subscription_users' %}?plan={{ plan.id }}" style="background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue)); color: var(--bg-darker); border: none; font-weight: 700; padding: 8px 16px; border-radius: 8px; text-decoration: none; box-shadow: 0 4px 12px rgba(0, 217, 255, 0.3); transition: all 0.3s ease; text-align: center; font-size: 12px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(0, 217, 255, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0, 217, 255, 0.3)';">
                                <i class="fas fa-users me-1"></i> Users
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <div>
                            <i class="fas fa-layer-group fa-3x mb-3" style="color: var(--gold); opacity: 0.5;"></i>
                            <h5 style="color: var(--chocolate-dark);">No subscription plans found</h5>
                            <p class="text-muted">Create your first subscription plan to get started.</p>
                            <a href="{% url 'admin_dashboard:subscription_plan_add' %}" class="btn" style="background: var(--gold); color: var(--chocolate-dark); border: none; font-weight: bold; padding: 10px 20px; border-radius: 6px;">
                                <i class="fas fa-plus me-1"></i> Create Plan
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Quick Actions & Export -->
<div style="background: linear-gradient(135deg, rgba(26, 31, 58, 0.9) 0%, rgba(10, 14, 39, 0.95) 100%); border-radius: 16px; padding: 28px; box-shadow: 0 0 40px rgba(0, 217, 255, 0.25), inset 0 0 20px rgba(0, 217, 255, 0.08); border: 1px solid var(--neon-blue); border-left: 5px solid var(--neon-cyan);">
    <div style="margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between;">
        <h5 style="color: var(--neon-cyan); font-weight: 800; font-size: 18px; margin: 0; text-shadow: 0 0 15px rgba(0, 217, 255, 0.6); letter-spacing: 0.5px;">
            <i class="fas fa-bolt me-2"></i>Quick Actions & Navigation
        </h5>
        <span style="background: rgba(0, 217, 255, 0.15); color: var(--neon-cyan); padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; border: 1px solid rgba(0, 217, 255, 0.3);">
            <i class="fas fa-rocket me-1"></i>Quick Access
        </span>
    </div>
    
    <div class="row g-3">
        <div class="col-lg-3 col-md-6">
            <a href="{% url 'admin_dashboard:subscription_users' %}" style="display: block; background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(147, 51, 234, 0.15)); border: 2px solid rgba(168, 85, 247, 0.4); border-radius: 14px; padding: 20px; text-decoration: none; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(168, 85, 247, 0.2); text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 30px rgba(168, 85, 247, 0.4)'; this.style.borderColor='#A855F7';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(168, 85, 247, 0.2)'; this.style.borderColor='rgba(168, 85, 247, 0.4)';">
                <i class="fas fa-users" style="font-size: 32px; color: #A855F7; margin-bottom: 12px; display: block;"></i>
                <div style="color: rgba(224, 231, 255, 0.95); font-weight: 700; font-size: 15px;">Manage Users</div>
                <small style="color: rgba(224, 231, 255, 0.5); font-size: 11px;">View subscribers</small>
            </a>
        </div>
        <div class="col-lg-3 col-md-6">
            <a href="{% url 'admin_dashboard:subscription_payments' %}" style="display: block; background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(6, 182, 212, 0.15)); border: 2px solid rgba(0, 217, 255, 0.4); border-radius: 14px; padding: 20px; text-decoration: none; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(0, 217, 255, 0.2); text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 30px rgba(0, 217, 255, 0.4)'; this.style.borderColor='var(--neon-cyan)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(0, 217, 255, 0.2)'; this.style.borderColor='rgba(0, 217, 255, 0.4)';">
                <i class="fas fa-receipt" style="font-size: 32px; color: var(--neon-cyan); margin-bottom: 12px; display: block;"></i>
                <div style="color: rgba(224, 231, 255, 0.95); font-weight: 700; font-size: 15px;">Payment History</div>
                <small style="color: rgba(224, 231, 255, 0.5); font-size: 11px;">Track transactions</small>
            </a>
        </div>
        <div class="col-lg-3 col-md-6">
            <a href="/payments/pricing/" style="display: block; background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(79, 70, 229, 0.15)); border: 2px solid rgba(99, 102, 241, 0.4); border-radius: 14px; padding: 20px; text-decoration: none; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(99, 102, 241, 0.2); text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 30px rgba(99, 102, 241, 0.4)'; this.style.borderColor='#6366F1';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(99, 102, 241, 0.2)'; this.style.borderColor='rgba(99, 102, 241, 0.4)';">
                <i class="fas fa-eye" style="font-size: 32px; color: #6366F1; margin-bottom: 12px; display: block;"></i>
                <div style="color: rgba(224, 231, 255, 0.95); font-weight: 700; font-size: 15px;">Preview Pricing</div>
                <small style="color: rgba(224, 231, 255, 0.5); font-size: 11px;">Public view</small>
            </a>
        </div>
        <div class="col-lg-3 col-md-6">
            <a href="{% url 'admin_dashboard:export_data' %}?type=subscriptions" style="display: block; background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.15)); border: 2px solid rgba(34, 197, 94, 0.4); border-radius: 14px; padding: 20px; text-decoration: none; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(34, 197, 94, 0.2); text-align: center;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 30px rgba(34, 197, 94, 0.4)'; this.style.borderColor='#22C55E';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(34, 197, 94, 0.2)'; this.style.borderColor='rgba(34, 197, 94, 0.4)';">
                <i class="fas fa-download" style="font-size: 32px; color: #22C55E; margin-bottom: 12px; display: block;"></i>
                <div style="color: rgba(224, 231, 255, 0.95); font-weight: 700; font-size: 15px;">Export Data</div>
                <small style="color: rgba(224, 231, 255, 0.5); font-size: 11px;">Download reports</small>
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Calculate total subscribers
    let totalSubs = 0;
    let totalRevenue = 0;
    
    document.querySelectorAll('.plan-total-subs').forEach(el => {
        const count = parseInt(el.textContent.trim()) || 0;
        totalSubs += count;
    });
    
    document.querySelectorAll('.plan-revenue').forEach(el => {
        const revenueText = el.textContent.replace(' RWF', '').trim();
        const revenue = parseFloat(revenueText) || 0;
        totalRevenue += revenue;
    });
    
    // Update totals
    document.getElementById('total-subscribers').textContent = totalSubs.toLocaleString();
    document.getElementById('total-monthly-revenue').textContent = totalRevenue.toLocaleString() + ' RWF';
    
    console.log('Subscription plans loaded:', {
        totalSubscribers: totalSubs,
        totalRevenue: totalRevenue
    });
});
</script>
{% endblock %}